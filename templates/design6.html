<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
<meta charset="utf-8">
<title>Aspern prototype</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>

<!-- Materialize -->
<link rel = "stylesheet"
href = "https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel = "stylesheet"
href = "https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
<script type = "text/javascript"
src = "https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js">
</script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Mapbox Assembly -->
<link
href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css"
rel="stylesheet"
/>
<script src="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.js"></script>

<!-- Bootstarp -->

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>


<!-- Turf  -->

<script src="https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js"></script>
<script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>

<!-- Draw -->

<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.2/mapbox-gl-draw.css" type="text/css">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.2/mapbox-gl-draw.js"></script>


<!-- Plotly -->
<script src="https://cdn.plot.ly/plotly-2.14.0.min.js"></script>


<!--    Popover.js-->
<script src="https://cdn.jsdelivr.net/npm/@floating-ui/core@1.0.2"></script>
<script src="https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.0.7"></script>


<style>
body {
    margin: 0;
    padding: 0;
  }
 #map {
    position: absolute;
    top: 0;
    bottom: 0;
    z-index: 0;
  }

  ul span{
    width: 16px;
    height: 16px;
    display: inline-block;
    margin-right: 8px;
    border-radius: 30%
  }



  .list-group {
    /* width: 250px; */
    width: 240px;

  }

  .mapboxgl-popup {
    max-width: 250px;
  }

  .mapboxgl-popup-content{
    font-size: 14px;
    color: rgba(0, 0, 0, 0.5);
    /* min-width: 200px;
    max-width: 400px; */
    box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.1);
    margin-bottom: 0;
    width: 250px;
    -webkit-text-size-adjust: auto;
  }


  p {
      font-family: 'Open Sans';
      margin: 0;
      font-size: 13px;
  }

    .navbar {
        border-width: 1.5px;
        border-style: solid;

    }

    .split {
        height: 70%;
        /*width: 74%;*/
        width: 100%;
        position: fixed;
        z-index: 1;
        overflow-x: hidden;
        padding-top: 20px;
    }

     .split_no_graph {
        height: 100%;
        /*width: 74%;*/
        width: 100%;
        position: fixed;
        z-index: 1;
        overflow-x: hidden;
        padding-top: 20px;
    }
        /* Control the left side */
    .left {
        left: 0;
    }
    /* Control the right side */
    .right {
        right: 0;
        height: 80%;
        width: 20%;
        overflow: auto;
    }
    /* Control the bottom side */
    .bottom {
        bottom: 0;
        height: 30%;
        width: 100%;
    }
    .header {
        /*float: inline-start;*/
        overflow: hidden;
        /* background-color: #f1f1f1; */
        padding: 20px 10px;
    }
    .offcanvas-body {
      position: absolute;
      top:90px;
      overflow: hidden;
      /*height: 80%;*/
    }

    .btn-group-sm {
      position: absolute;
      /* left: 30px; */
      top:70px;
    }

    .form-control {
        width: auto;
    }


    #btn-open-layers {
        position: absolute;
        z-index: 1;
        top: 10px;
        left: 10px;
        border-radius: 3px;
        width: 50px;
        height: 25px;
        align-content:flex-start
    }

      #btn-open-legend {
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 50px;
        height: 25px;
        align-content:flex-start
    }

    /* https://stackoverflow.com/questions/73292950/change-bootstrap-offcanvas-size-via-css-bootstrap-5-2 */
    .offcanvas-size-sm {
    --bs-offcanvas-width: min(95vw, 250px) !important;
    }

    .navbar-nav {
        width: 250px;
        height: 260px;
    }

    .form-check-input:checked {
        background-color: #404040;
        border-color:rgba(0, 0, 0, 0.25);
    }
    .offcanvas-end {
        height:70%;
        --bs-offcanvas-width: 26%;
    }
    /* for the range */
    /* source: https://stackoverflow.com/questions/40534973/changing-the-color-of-the-range-slider-in-materializecss */
    input[type=range]::-webkit-slider-thumb {
        background-color: #757d82;
    }
    input[type=range]::-moz-range-thumb {
        background-color: #757d82;
    }
    input[type=range]::-ms-thumb {
        background-color: #757d82;
    }
    /***** These are to edit the thumb and the text inside the thumb *****/
    input[type=range] + .thumb {
        background-color: #dedede;
    }
    input[type=range] + .thumb.active .value {
        color: #757d82;
    }


    [type="checkbox"]:checked+label:before {
        border-right: 2px solid #757d82;
    border-bottom: 2px solid #757d82;
    }

    .btn-group-sm {
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 80px;
        align-content:flex-start
    }

    #index_calc {
        height: 25px
    }

    .btn-group-sm>.btn, .btn-sm {
        --bs-btn-font-size: 0.75rem;
    }

    .btn {
        --bs-btn-padding-x: none;
    }


    /* style scrollbar */
    .offcanvas::-webkit-scrollbar {
        width: 12px;               /* width of the entire scrollbar */
    }

    .offcanvas::-webkit-scrollbar-track {
        background: whitesmoke;        /* color of the tracking area */
    }

    .offcanvas::-webkit-scrollbar-thumb {
        background-color: darkgrey;    /* color of the scroll thumb */
        border-radius: 20px;       /* roundness of the scroll thumb */
        border: 3px solid whitesmoke;  /* creates padding around scroll thumb */
    }


    #select-form {
        font-size: 14px;
    }

    form {
        font-size: 14px;
    }



    .form-select {
      width: 30px !important;
    }

    select {
        border-color: #f2f2f21a;
    }

    select option:hover {
        background-color: #404040;
    }



    /*new layers design*/
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0, 0, 0, 0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu label {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        /*padding: 0;*/
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        text-align: center;
    }

    #menu label:last-child {
        border: none;
    }

    #menu label:hover {
        background-color: #f8f8f8;
        color: #404040;
    }
    /*#menu label, a.nav-link>input:checked {*/
    /*    background-color: #3887be;*/
    /*    color: #ffffff;*/
    /*}*/

    /*#menu label, input:checked:hover {*/
    /*    background: #3074a4;*/
    /*    !* color: #00008b; *!*/
    /*}*/


     .dropdown-menu {
         width: 100%;
     }

     .layers_ul {
        --bs-dropdown-border-color: none;
        --bs-dropdown-link-active-bg: none;
    }


    /*toggle 3d later button */

    .form-switch {
      position: absolute;
      /*bottom: 0.5%;*/
      /*right: 7%;*/
      /*bottom: 36%;*/
      /*right: 26.8%;*/
      right: 1%;
      z-index: 1;
      /*display: inline-block;*/
      width: 60px;
      height: 34px;
    }

     .button3d_bottom_graph {
      bottom: 36%;
    }

    .button3d_bottom_no_graph {
      bottom: 6%;
    }

    /*show only the tick from materialize, hide the bootstrap checkbox*/
    [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        visibility: hidden;
    }

    /*3d button change colors*/
     .form-check-input:focus {
        border-color: rgb(108 117 125);
        box-shadow: 0 0 0 0.25rem #6c757d45;
    }
     .form-switch .form-check-input:focus {
        background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'><circle r='3' fill='%231a2224bf'/></svg>");
    }
     .form-check-input:checked {
        background-color: #6c757d;
        border-color: rgba(0, 0, 0, 0.25);
    }

    /*for the 3d checkbox, hide the materialize tick */
    #aspern_bkmBlocks:not(:checked), #aspern_bkmBlocks:checked {
        visibility: visible;
    }

    #aspern_bkmBlocks:not(:checked), #aspern_bkmBlocks:checked {
        position: initial;
    }

    #aspern_bkmBlocks+label:before {
        content: none;
    }

    #aspern_bkmBlocks+label {
        padding-left:0px;
    }


    /*legend */
    /*#legend {*/
    /*    !* background: white;  *!*/
    /*    !* width: 300px;  *!*/
    /*    border: 1px solid rgba(0, 0, 0, 0.05);*/
    /*    position: absolute;*/
    /*    z-index: 1;*/
    /*    right: 27%;*/
    /*    box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.1);*/
    /*    color: rgba(0, 0, 0, 0.5);*/
    /*    }*/
    /*.legend_ul ul{*/
    /*    list-style-type: none;*/
    /*    margin: 0;*/
    /*    padding: 16px;*/
    /*    width: 300px;*/
    /*}*/
    /*.legend_ul ul span{*/
    /*    width: 10px;*/
    /*    height: 10px;*/
    /*    display: inline-block;*/
    /*    margin-right: 8px;*/
    /*    border-radius: 50%*/
    /*}*/
    /*.legend_ul {*/
    /*    height: 200px;*/
    /*    width: 180px;*/
    /*    border: 1px  solid #eee;*/
    /*    padding: 5px;*/
    /*    overflow-y: auto;*/
    /*}*/

    #btn-close-layers:focus {
        background-color: #757d82;
        box-shadow: 0 0 0 0.25rem rgb(26 34 36 / 25%);
    }

     #btn-close-legend:focus {
        background-color: #757d82;
        box-shadow: 0 0 0 0.25rem rgb(26 34 36 / 25%);
    }

    input[type=text]:focus:not([readonly]){
        border-bottom: 1px solid transparent;
        box-shadow: 0 1px 0 0 transparent;
    }
    input[type=text] {
        border-bottom: 1px solid transparent
    }

    button:focus {
        background-color: lightgray;
    }


    /*color range */
    .row {
      height: 12px;
      width: 100%;

      --bs-gutter-x: 0;
    }

    .colors {
      margin-bottom: 5px;

    }

    .labels .label {
      width: 15%;
      display: inline-block;
      text-align: center;
    }

    li.label {
      width: 6.7%;
      display: inline-block;
      text-align: center;
    }






    /*Layers sections */
    #blocks_group {
        position: absolute;
        z-index: 0;
        top: 2%;
        right: 1%;
        align-content: flex-start;
    }

    #blocks_content {
        position: absolute;
        z-index: 1;
        top: 5%;
        right: 1%;
    }

    #landuse_group {
        position: absolute;
        z-index: 0;
        top: 8%;
        right: 1%;
        align-content: flex-start;
    }

    #landuse_content {
        position: absolute;
        top: 11%;
        right: 1%;
        z-index: 1;
    }

    #zoning_group {
        position: absolute;
        z-index: 0;
        top: 14%;
        right: 1%;
        align-content: flex-start;
    }

    #zoning_content {
        position: absolute;
        top: 17%;
        right: 1%;
        z-index: 1;
    }

    #streets_group {
        position: absolute;
        z-index: 0;
        top: 20%;
        right: 1%;
        align-content: flex-start;
    }

    #streets_content {
        position: absolute;
        top: 23%;
        right: 1%;
        z-index: 1;
    }

    #public_lines_group {
        position: absolute;
        z-index: 0;
        top: 26%;
        right: 1%;
        align-content: flex-start;
    }

    #public_lines_content {
        position: absolute;
        top: 29%;
        right: 1%;
        z-index: 1;
    }

    #shops_group {
        position: absolute;
        z-index: 0;
        top: 32%;
        right: 1%;
        align-content: flex-start;
    }

    #shops_content {
        position: absolute;
        top: 35%;
        right: 1%;
        z-index: 1;
    }

    #trees_group {
        position: absolute;
        z-index: 0;
        top: 38%;
        right: 1%;
        align-content: flex-start;
    }

    #trees_content {
        position: absolute;
        top: 41%;
        right: 1%;
        z-index: 1;
    }

    #public_stations_group {
        position: absolute;
        z-index: 0;
        top: 44%;
        right: 1%;
        align-content: flex-start;
    }

    #public_stations_content {
        position: absolute;
        top: 47%;
        right: 1%;
        z-index: 1;
    }

    /*shannon button */
    #shannon_group {
        position: absolute;
        z-index: 0;
        top: 50%;
        right: 1%;
        align-content: flex-start;
    }

    #shannon_content {
        position: absolute;
        z-index: 1;
        top: 53%;
        right: 1%;
    }

    #green_group {
        position: absolute;
        z-index: 0;
        top: 56%;
        right: 1%;
        align-content: flex-start;
    }

    #green_content {
        position: absolute;
        top: 59%;
        right: 1%;
        z-index: 1;
    }

    #osr_group {
        position: absolute;
        z-index: 0;
        top: 62%;
        right: 1%;
        align-content: flex-start;
    }

    #osr_content {
        position: absolute;
        top: 65%;
        right: 1%;
        z-index: 1;
    }

    #max_height_group {
        position: absolute;
        z-index: 0;
        top: 68%;
        right: 1%;
        align-content: flex-start;
    }

    #max_height_content {
        position: absolute;
        top: 71%;
        right: 1%;
        z-index: 1;
    }

    #accessibility_group {
        position: absolute;
        z-index: 0;
        top: 74%;
        right: 1%;
        align-content: flex-start;
    }

    #accessibility_content {
        position: absolute;
        /*top: 77%;*/
        right: 1%;
        z-index: 1;
        bottom: 24%;
    }




    #retore_changes_group {
        position: absolute;
        z-index: 1;
        bottom: 10%;
        right: 1%;
        top: 83%;
    }

    #retore_changes {
        width: 57px;
        font-size: xx-small;
        height: fit-content;
        /*--bs-btn-padding-x: 0;*/

    }



    .btn:hover {
        background-color: #6c757d;
        border-color: #2125296b;
    }
    .btn:active {
        background-color: #6c757d;
        border-color: #2125296b;
    }
    .btn:focus {
        background-color: #6c757d;
        border-color: #2125296b;
    }

    .btn-group>.btn {
        height: 25px;
        width: 140px;
    }

    /*#legend_section {*/
    /*   position: absolute;*/
    /*    z-index: 1;*/
    /*    top: 10px;*/
    /*    left: 20px;*/
    /*    border-radius: 3px;*/
    /*    width: 50px;*/
    /*    height: 25px;*/
    /*    align-content:flex-start*/
    /*}*/

    .card {
        width: 18rem;
        /*display:none;*/
        height: 20%
    }
    .card-body{
        height: 90%;  padding-top: 1px;
    }

    #shannon_content .label {
        width: 19%;
    }

    .spinner-border-sm {
    --bs-spinner-border-width: 0.1em;
    }

    .card .btn-close{
        position: absolute;
        right: 0px;

    }

    #accessibility_content .card-body{
        padding: 0;
    }

    /*for the shannon graph*/
     .js-plotly-plot .plotly .main-svg {
        width: 250px;
    }


    /*for the text and checkbox style*/
    [type="checkbox"]+label {
        padding-left: 25px;
        line-height: 15px;
        font-size: small;
        position: initial;
    }
    [type="checkbox"]+label:before {
        margin-top: 0;
    }
    label {
        color: #4d5255;
    }

    .collapse .card-body {
        height: 2%;
        max-width: 30%;
    }


    /*toolbar*/
    #toolbar{
        bottom: 0%;
        z-index: 1;
        position: absolute;
        align-self: center;
        right:45%;
        height: fit-content;
        background: transparent;
    }
    .nav-pills {
        --bs-nav-pills-link-active-bg: #6c757de0;
    }
    .nav {
        --bs-nav-link-color: rgb(0 0 5 / 83%);
        --bs-nav-link-hover-color: rgb(0 0 5 / 83%);
    }

    #main_layers {
        position: absolute;
        left: 1%;
        top: 2%;
    }

    .collapsible-header {
        background: transparent;
    }
    .collapsible {
        padding-left: 0px;
        width: 18rem;
    }







</style>
</head>
<body>


<div id="map" class="split_no_graph left"></div>


<!--3d button -->
<div>
    <div class="form-check form-switch button3d_bottom_no_graph" >
      <input class="form-check-input" type="checkbox" id="aspern_bkmBlocks">
      <label class="form-check-label" for="aspern_bkmBlocks">3D</label>
    </div>
</div>



<!--collapsible -->
<!--<div id="main_layers">-->
<!--<ul class="collapsible">-->
<!--    <li>-->
<!--      <div class="collapsible-header"><i class="material-icons">filter_drama</i>First</div>-->
<!--      <div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>-->
<!--    </li>-->
<!--    <li>-->
<!--      <div class="collapsible-header"><i class="material-icons">place</i>Second</div>-->
<!--      <div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>-->
<!--    </li>-->
<!--    <li>-->
<!--      <div class="collapsible-header"><i class="material-icons">whatshot</i>Third</div>-->
<!--      <div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>-->
<!--    </li>-->
<!--</ul>-->
<!--</div>-->


<!--................Layers..................-->
<!--.......Land Use........-->
<!--blocks section-->
<section>
<div class="btn-group btn-group-sm" id="blocks_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="aspern_blocks_attr" data-bs-toggle="collapse" data-bs-target="#collapseBlocks" aria-expanded="false" aria-controls="collapseBlocks">
        <label class="form-check-label" for="aspern_blocks_attr">
            Blocks
        </label>
    </button>

    <button id="blocks_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseBlocks" style=" z-index: 1; position: absolute; top: 5%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 5%; right: 1%; max-width: 30%;">
        <ul>
        <li class="label"><span style="background: #60c36c;" data-bs-toggle="tooltip" data-bs-placement="left" title="greenSpace: green open spaces, gardens, agricultural land"></span></li>
        <li class="label"><span style="background: #856666;" data-bs-toggle="tooltip" data-bs-placement="left" title="sealedSpace: public and private sealed area, including roads, bike paths etc."></span></li>
        <li class="label"><span style="background: #ad949e;" data-bs-toggle="tooltip" data-bs-placement="left" title="buildings"></span></li>
        <li class="label"><span style="background: #808080;" data-bs-toggle="tooltip" data-bs-placement="left" title="construction: construction sites, gravel pit"></span></li>
        <li class="label"><span style="background: #0080FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="water"></span></li>
       </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="blocks_content">
    <button id="btn-close-blocks" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Generalised blocks</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

      <div id="legend_blocks" >
        <ul>
            <li><span style="background: #60c36c;"></span>greenSpace: <em>green open spaces, gardens, agricultural land</em></li>
            <li><span style="background: #856666;"></span>sealedSpace: <em>public and private sealed area, including roads, bike paths etc.</em></li>
            <li><span style="background: #ad949e;"></span>buildings</li>
            <li><span style="background: #808080;"></span>construction: <em>construction sites, gravel pit</em></li>
            <li><span style="background: #0080FF;"></span>water</li>
        </ul>
      </div>

      <div id="graph_blocks">

      </div>

  </div>

</div>
</section>
<!--land-use section-->
<section>
<div class="btn-group btn-group-sm" id="landuse_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="aspern_landuse" data-bs-toggle="collapse" data-bs-target="#collapseLanduse" aria-expanded="false" aria-controls="collapseLanduse">
        <label class="form-check-label" for="aspern_landuse">
            Land Use
        </label>
    </button>

    <button id="landuse_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseLanduse" style=" z-index: 1; position: absolute; top: 11%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 11%; right: 1%; max-width: 30%;">
        <ul>
        <li class="label"><span style="background: #88db35;" data-bs-toggle="tooltip" data-bs-placement="left" title="recreation & leisure facilities"></span></li>
        <li class="label"><span style="background: #e2d4c0;" data-bs-toggle="tooltip" data-bs-placement="left" title="business uses"></span></li>
        <li class="label"><span style="background: #60c8c5;" data-bs-toggle="tooltip" data-bs-placement="left" title="water"></span></li>
        <li class="label"><span style="background: #de8d24;" data-bs-toggle="tooltip" data-bs-placement="left" title="industrial & commercial uses"></span></li>
        <li class="label"><span style="background: #8baf76;" data-bs-toggle="tooltip" data-bs-placement="left" title="agriculture"></span></li>
        <li class="label"><span style="background: #bce48b;" data-bs-toggle="tooltip" data-bs-placement="left" title="natural area"></span></li>
        <li class="label"><span style="background: #c4bcef;" data-bs-toggle="tooltip" data-bs-placement="left" title="social infrastructure"></span></li>
        <li class="label"><span style="background: #c2d0a1;" data-bs-toggle="tooltip" data-bs-placement="left" title="technical infrastructure"></span></li>
        <li class="label"><span style="background: #a8cfc6;" data-bs-toggle="tooltip" data-bs-placement="left" title="other transportation uses"></span></li>
        <li class="label"><span style="background: #d9bdc6;" data-bs-toggle="tooltip" data-bs-placement="left" title="residential use"></span></li>
        <li class="label"><span style="background: #d2e0c5;" data-bs-toggle="tooltip" data-bs-placement="left" title="road space"></span></li>
       </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="landuse_content">
    <button id="btn-close-landuse" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Land Use - block level</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

      <div id="legend_landuse">
        <ul>
            <li><span style="background: #88db35;"></span>recreation and leisure facilities</li>
            <li><span style="background: #e2d4c0;"></span>business and mixed use with emphasis on business activity</li>
            <li><span style="background: #60c8c5;"></span>water</li>
            <li><span style="background: #de8d24;"></span>industrial and commercial uses</li>
            <li><span style="background: #8baf76;"></span>agriculture</li>
            <li><span style="background: #bce48b;"></span>natural area</li>
            <li><span style="background: #c4bcef;"></span>social infrastructure</li>
            <li><span style="background: #c2d0a1;"></span>technical infrastructure/art buildings/special uses</li>
            <li><span style="background: #a8cfc6;"></span>other transportation uses</li>
            <li><span style="background: #d9bdc6;"></span>residential and mixed use with emphasis on residential</li>
            <li><span style="background: #d2e0c5;"></span>road space</li>

        </ul>
      </div>

      <div id="graph_landuse">

      </div>

  </div>
</div>
</section>
<!--zoning section-->
<section>
<div class="btn-group btn-group-sm" id="zoning_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="zoning" data-bs-toggle="collapse" data-bs-target="#collapseZoning" aria-expanded="false" aria-controls="collapseZoning">
        <label class="form-check-label" for="zoning">
            Zoning
        </label>
    </button>

    <button id="zoning_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseZoning" style=" z-index: 1; position: absolute; top: 17%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 17%; right: 1%; max-width: 30%;">
        <ul>
            <li class="label"><span style="background: #774c43;" data-bs-toggle="tooltip" data-bs-placement="left" title="E: recreation area"></span></li>
            <li class="label"><span style="background: #8B4513;" data-bs-toggle="tooltip" data-bs-placement="left" title="GB: mixed developement"></span></li>
            <li class="label"><span style="background: #D2691E;" data-bs-toggle="tooltip" data-bs-placement="left" title="GBBG: mixed developement - business developement area"></span></li>
            <li class="label"><span style="background: #CD853F;" data-bs-toggle="tooltip" data-bs-placement="left" title="GBGV: mixed developement - business district"></span></li>
            <li class="label"><span style="background: #F4A460;" data-bs-toggle="tooltip" data-bs-placement="left" title="IG: industrial area"></span></li>
            <li class="label"><span style="background: #DEB887;" data-bs-toggle="tooltip" data-bs-placement="left" title="S: protected area"></span></li>
            <li class="label"><span style="background: #FFE4B5;" data-bs-toggle="tooltip" data-bs-placement="left" title="WO: residential area"></span></li>
            <li class="label"><span style="background: #000000;" data-bs-toggle="tooltip" data-bs-placement="left" title="Other"></span></li>
       </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="zoning_content">
    <button id="btn-close-zoning" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Zoning</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

      <div id="legend_zoning">
        <ul>
            <li><span style="background: #774c43;"></span>E: <em>recreation area</em></li>
            <li><span style="background: #8B4513;"></span>GB: <em>mixed developement</em></li>
            <li><span style="background: #D2691E;"></span>GBBG: <em>mixed developement - business developement area</em></li>
            <li><span style="background: #CD853F;"></span>GBGV: <em>mixed developement - business district</em></li>
            <li><span style="background: #F4A460;"></span>IG: <em>industrial area</em></li>
            <li><span style="background: #DEB887;"></span>S: <em>protected area</em></li>
            <li><span style="background: #FFE4B5;"></span>WO: <em>residential area</em></li>
            <li><span style="background: #000000;"></span>Other</li>

        </ul>
      </div>

      <div id="graph_zoning">

      </div>

  </div>
</div>
</section>

<!--.......Road & Transport........-->
<!--street section-->
<section>
<div class="btn-group btn-group-sm" id="streets_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="aspern_roads" data-bs-toggle="collapse" data-bs-target="#collapseStreets" aria-expanded="false" aria-controls="collapseStreets">
        <label class="form-check-label" for="aspern_roads">
            Streets
        </label>
    </button>

    <button id="streets_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseStreets" style=" z-index: 1; position: absolute; top: 23%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 23%; right: 1%; max-width: 30%;">
        <ul>
        <li class="label"><span style="background: #FFFF66;" data-bs-toggle="tooltip" data-bs-placement="left" title="G: municipal road"></span></li>
            <li class="label"><span style="background: #FF9933;" data-bs-toggle="tooltip" data-bs-placement="left" title="L: state main road"></span></li>
            <li class="label"><span style="background: #a117c7;" data-bs-toggle="tooltip" data-bs-placement="left" title="B: main road"></span></li>
       </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="streets_content">
    <button id="btn-close-streets" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Street center-line</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

      <div id="legend_streets">
        <ul>
            <li><span style="background: #FFFF66;"></span>G: <em>municipal road</em></li>
            <li><span style="background: #FF9933;"></span>L: <em>state main road</em></li>
            <li><span style="background: #a117c7;"></span>B: <em>main road</em></li>

        </ul>
      </div>

      <div id="graph_streets">

      </div>

  </div>
</div>
</section>

<!--public transport lines section-->
<section>
<div class="btn-group btn-group-sm" id="public_lines_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="aspern_publiclines" data-bs-toggle="collapse" data-bs-target="#collapsePublic_lines" aria-expanded="false" aria-controls="collapsePublic_lines">
        <label class="form-check-label" for="aspern_publiclines">
            Public Lines
        </label>
    </button>

    <button id="public_lines_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapsePublic_lines" style=" z-index: 1; position: absolute; top: 29%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 29%; right: 1%; max-width: 30%;">
        <ul>
        <li class="label"><span style="background: #CC0000;" data-bs-toggle="tooltip" data-bs-placement="left" title="13: astax"></span></li>
        <li class="label"><span style="background: #FF8000;" data-bs-toggle="tooltip" data-bs-placement="left" title="3: regional bus"></span></li>
        <li class="label"><span style="background: #FFFF00;" data-bs-toggle="tooltip" data-bs-placement="left" title="2: bus"></span></li>
        <li class="label"><span style="background: #00FF00;" data-bs-toggle="tooltip" data-bs-placement="left" title="5: rapid transit and regional train"></span></li>
        <li class="label"><span style="background: #00FFFF;" data-bs-toggle="tooltip" data-bs-placement="left" title="9: astax"></span></li>
        <li class="label"><span style="background: #0000FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="10: night bus"></span></li>
        <li class="label"><span style="background: #FF33FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="11: night bus"></span></li>
        <li class="label"><span style="background: #FF3399;" data-bs-toggle="tooltip" data-bs-placement="left" title="4: subway"></span></li>
       </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="public_lines_content">
    <button id="btn-close-public_lines" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Public transport lines</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

      <div id="legend_public_lines">
        <ul>
            <li><span style="background: #CC0000;"></span>13: <em>astax</em></li>
            <li><span style="background: #FF8000;"></span>3: <em>regional bus</em></li>
            <li><span style="background: #FFFF00;"></span>2: <em>bus</em></li>
            <li><span style="background: #00FF00;"></span>5: <em>rapid transit and regional train</em></li>
            <li><span style="background: #00FFFF;"></span>9: <em>astax</em></li>
            <li><span style="background: #0000FF;"></span>10: <em>night bus</em></li>
            <li><span style="background: #FF33FF;"></span>11: <em>night bus</em></li>
            <li><span style="background: #FF3399;"></span>4: <em>subway</em></li>

        </ul>
      </div>

      <div id="graph_public_lines">

      </div>

  </div>
</div>
</section>

<!--.......PoI........-->
<!--shops section-->
<section>
<div class="btn-group btn-group-sm" id="shops_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="shops" data-bs-toggle="collapse" data-bs-target="#collapseShops" aria-expanded="false" aria-controls="collapseShops">
        <label class="form-check-label" for="shops">
            Shops
        </label>
    </button>

    <button id="shops_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseShops" style=" z-index: 1; position: absolute; top: 35%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 35%; right: 1%; max-width: 30%;">
        <ul>
        </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="shops_content">
    <button id="btn-close-shops" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Shops</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

     <div id="legend_shops">
        <ul>

        </ul>
      </div>

      <div id="graph_shops">

      </div>

  </div>
</div>
</section>

<!--trees section-->
<section>
<div class="btn-group btn-group-sm" id="trees_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="aspern_trees_blocks" data-bs-toggle="collapse" data-bs-target="#collapseTrees" aria-expanded="false" aria-controls="collapseTrees">
        <label class="form-check-label" for="aspern_trees_blocks">
            Trees
        </label>
    </button>

    <button id="trees_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseTrees" style=" z-index: 1; position: absolute; top: 41%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 41%; right: 1%; max-width: 30%;">
        <ul>
        </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="trees_content">
    <button id="btn-close-trees" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Trees</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

     <div id="legend_trees">
        <ul>
            <li><strong>Classification Categories of Tree height: </strong></li>
            <br>
            <li><span style="background: #99FF99;"></span>0</li>
            <li><span style="background: #66FF66;"></span>1</li>
            <li><span style="background: #33FF33;"></span>2</li>
            <li><span style="background: #00CC00;"></span>3</li>
            <li><span style="background: #00CC00;"></span>4</li>
            <li><span style="background: #009900;"></span>5</li>

        </ul>
      </div>

      <div id="graph_trees">

      </div>

  </div>
</div>
</section>

<!--public transport stations section-->
<section>
<div class="btn-group btn-group-sm" id="public_stations_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="aspern_publicstops" data-bs-toggle="collapse" data-bs-target="#collapsePublic_stations" aria-expanded="false" aria-controls="collapsePublic_stations">
        <label class="form-check-label" for="aspern_publicstops">
            Public stops
        </label>
    </button>

    <button id="public_stations_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapsePublic_stations" style=" z-index: 1; position: absolute; top: 47%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 47%; right: 1%; max-width: 30%;">
        <ul>
        <li class="label"><span style="background: #CC0000;" data-bs-toggle="tooltip" data-bs-placement="left" title="13: astax"></span></li>
        <li class="label"><span style="background: #FF8000;" data-bs-toggle="tooltip" data-bs-placement="left" title="3: regional bus"></span></li>
        <li class="label"><span style="background: #FFFF00;" data-bs-toggle="tooltip" data-bs-placement="left" title="2: bus"></span></li>
        <li class="label"><span style="background: #00FF00;" data-bs-toggle="tooltip" data-bs-placement="left" title="5: rapid transit and regional train"></span></li>
        <li class="label"><span style="background: #00FFFF;" data-bs-toggle="tooltip" data-bs-placement="left" title="9: astax"></span></li>
        <li class="label"><span style="background: #0000FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="10: night bus"></span></li>
        <li class="label"><span style="background: #FF33FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="11: night bus"></span></li>
        <li class="label"><span style="background: #FF3399;" data-bs-toggle="tooltip" data-bs-placement="left" title="4: subway"></span></li>
       </ul>
    </div>
</div>

<div class="card" style="width: 18rem; display:none; height: fit-content" id="public_stations_content">
    <button id="btn-close-public_stations" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Public transport stations</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
      <br>

      <div id="legend_public_stations">
        <ul>
            <li><span style="background: #CC0000;"></span>13: <em>astax</em></li>
            <li><span style="background: #FF8000;"></span>3: <em>regional bus</em></li>
            <li><span style="background: #FFFF00;"></span>2: <em>bus</em></li>
            <li><span style="background: #00FF00;"></span>5: <em>rapid transit and regional train</em></li>
            <li><span style="background: #00FFFF;"></span>9: <em>astax</em></li>
            <li><span style="background: #0000FF;"></span>10: <em>night bus</em></li>
            <li><span style="background: #FF33FF;"></span>11: <em>night bus</em></li>
            <li><span style="background: #FF3399;"></span>4: <em>subway</em></li>
        </ul>
      </div>

      <div id="graph_public_stations">

      </div>

  </div>
</div>
</section>


<!--.......Analysis........-->
<!--shannon section-->
<section>
<div class="btn-group btn-group-sm" id="shannon_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="shannon" class="btn btn-outline-dark">Shannon Index</button>-->
    <button type="button" id="shannon" class="form-check btn btn-outline-dark">
        <input class="" type="checkbox" value="" id="index">
        <label class="" for="index">
            Shannon
        </label>
    </button>
<!--    form-check-input form-check-label-->

    <button id="shannon_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>


</div>

<div class="card" style="width: 18rem; display:none; height: 20%" id="shannon_content">
    <button id="btn-close-shannon" type="button" class="btn-close" aria-label="Close"></button>

    <button type="button" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="left" title="Recompute index" style="
    position: absolute;height: 25px;width: 30px;" id="recalculate_index"><i style="font-size: 1.1rem" class="material-icons small">input</i></button>
    <h6 class="card-title"style="text-align: center;">Shannon Index
<!--        <div class="spinner-border spinner-border-sm" role="status" style="display: inline-block;">-->
<!--          <span class="visually-hidden">Loading...</span>-->
<!--        </div>-->
    </h6>

  <div class="card-body" style="height: 90%;  padding-top: 1px;">
    <p class="card-text">A measure of the variety of land uses in an area, indicating the number of different classes</p>

        <div>
          <div>
            <div class='row colors' style="background: linear-gradient(to right, #e1aeb4, #d3828f,#d55f5f, #b42f2f, #8c172c);">
            </div>
            <div class='row labels'>
              <div class='label'>0.8</div>
              <div class='label'>1</div>
              <div class='label'>1.4</div>
              <div class='label'>1.8</div>
              <div class='label'>2.21</div>
            </div>
          </div>
        </div>

      <div id="shannon_graph">

      </div>

  </div>
</div>
</section>

<!--green section-->
<section>
<div class="btn-group btn-group-sm" id="green_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="green" class="btn btn-outline-dark">Green Area </button>-->
<!--form-check-input    dropdown-item-->

    <button type="button" class="form-check btn btn-outline-dark"
    data-bs-toggle="collapse" data-bs-target="#collapseGreen" aria-expanded="false" aria-controls="collapseGreen">
        <input class="form-check-input" type="checkbox" value="" id="green_area" >
        <label class="form-check-label" for="green_area">
            Green Area
        </label>
    </button>

    <button id="green_arrow" type="button" class="btn btn-outline-dark"
            style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>

</div>

<div class="collapse" id="collapseGreen" style=" z-index: 1; position: absolute; top: 59%; right: 1%;">
    <div class="card-body" style=" z-index: 1; position: fixed; top: 59%; right: 1%; max-width: 40%;">
        <ul>
<!--        <li class="label"><span style="background: #60c36c;" data-bs-toggle="tooltip" data-bs-placement="left" title="greenSpace: green open spaces, gardens, agricultural land"></span></li>-->
<!--        <li class="label"><span style="background: #856666;" data-bs-toggle="tooltip" data-bs-placement="left" title="sealedSpace: public and private sealed area, including roads, bike paths etc."></span></li>-->
<!--        <li class="label"><span style="background: #ad949e;" data-bs-toggle="tooltip" data-bs-placement="left" title="buildings"></span></li>-->
<!--        <li class="label"><span style="background: #808080;" data-bs-toggle="tooltip" data-bs-placement="left" title="construction: construction sites, gravel pit"></span></li>-->
<!--        <li class="label"><span style="background: #0080FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="water"></span></li>-->
       </ul>
    </div>
</div>

<div class="card " style="width: 18rem; display:none; height: 20%" id="green_content">
    <button id="btn-close-green" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Green Area</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
    <p class="card-text"> Share (percentage) of green area within block</p>
      <br>

      <div>
          <div>
            <div class='row colors' style="background: linear-gradient(to right, #72de62, #6cd15c,#66c758, #62bf54, #5eb851, #57a84a, #4f9943, #478a3d, #3e7835, #34662d);">
            </div>
            <div class='row labels'>
              <div class='label'>10</div>
              <div class='label'>30</div>
              <div class='label'>50</div>
              <div class='label'>70</div>
              <div class='label'>90</div>
              <div class='label'>110</div>
            </div>
          </div>
        </div>

  </div>
</div>
</section>

<!--osr section-->
<section>
<div class="btn-group btn-group-sm" id="osr_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="osrbut" class="btn btn-outline-dark ">Open Space Ratio</button>-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="osr" >
        <label class="form-check-label" for="osr">
            OSR
        </label>
    </button>

    <button id="osr_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>


</div>

<div class="card" style="width: 18rem; display:none; height: 20%" id="osr_content">
    <button id="btn-close-osr" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">OSR</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
    <p class="card-text"> Open space share relative to the building square footage</p>
      <br>


      <div>
          <div>
            <div class='row colors' style="background: linear-gradient(to right, #a9d6e5, #89c2d9,#61a5c2, #468faf, #2c7da0, #2a6f97, #014f86, #01497c, #013a63);">
            </div>
            <div class='row labels'>
              <div class='label'>5</div>
              <div class='label'>10</div>
              <div class='label'>30</div>
              <div class='label'>50</div>
              <div class='label'>80</div>
              <div class='label'>100</div>
            </div>
          </div>
        </div>

  </div>
</div>
</section>

<!--max height section-->
<section>
<div class="btn-group btn-group-sm" id="max_height_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="max_heightbut" class="btn btn-outline-dark ">Max Height</button>-->

    <button type="button" class="form-check btn btn-outline-dark">
        <input class="form-check-input" type="checkbox" value="" id="max_height" >
        <label class="form-check-label" for="max_height">
            Max height
        </label>
    </button>

    <button id="max_height_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>


</div>

<div class="card" style="width: 18rem; display:none; height: 20%" id="max_height_content">
    <button id="btn-close-max_height" type="button" class="btn-close" aria-label="Close"></button>
    <h6 class="card-title" style="text-align: center;">Max height</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px;">
    <p class="card-text"> Maximum height of buildings within block</p>
      <br>

      <div>
          <div>
            <div class='row colors' style="background: linear-gradient(to right,  #edc4b3, #e6b8a2,#deab90, #cd9777, #c38e70, #b07d62, #9d6b53, #8a5a44);">
            </div>
            <div class='row labels'>
              <div class='label'>10</div>
              <div class='label'>30</div>
              <div class='label'>50</div>
              <div class='label'>70</div>
              <div class='label'>90</div>
              <div class='label'>100</div>
            </div>
          </div>
        </div>

  </div>
</div>
</section>

<!--accessibility section-->
<section>
<div class="btn-group btn-group-sm" id="accessibility_group" role="group" aria-label="Small button group">
<!--    <button type="button" id="accessibilitybut" class="btn btn-outline-dark ">Accessibility</button>-->

        <button type="button" id="accessibilitybut" class="form-check btn btn-outline-dark">
        <input class="" type="checkbox" value="" id="accessibility" >
        <label class="" for="accessibility">
            Accessibility
        </label>
    </button>

    <button id="accessibility_arrow" type="button" class="btn btn-outline-dark" style=" width: 1px"><i style="font-size: 1.1rem; right: 0px; position: absolute; top: 0px;" class="material-icons medium">arrow_drop_down</i></button>


</div>

<div class="card" style="width: 18rem; display:none; height: 40%" id="accessibility_content">
    <button id="btn-close-accessibility" type="button" class="btn-close" aria-label="Close"></button>
     <button type="button" class="btn btn-light" data-bs-toggle="tooltip" data-bs-placement="left" title="Compute accessibility" style="
    position: absolute;height: 25px;width: 30px;" id="calc_accessibility"><i style="font-size: 1.1rem" class="material-icons small">input</i></button>
    <h6 class="card-title" style="text-align: center;">Accessibility</h6>

  <div class="card-body" style="height: 90%; padding-top: 1px; padding-left: 5%;">
<!--    <p class="card-text">text...</p>-->
      <br>

      <div>
          <h6 class="txt-m txt-bold mb6">Distance:</h6>
          <form action="#" style="width:80%; font-size: 14px">
              <p class="range-field">
                  <input type="range" id="test" min="50" max="500" step="50"  value="'+span_text+'">
                  <span class="thumb">
<!--                      <span class="value"></span>-->
                  </span>
              </p>
          </form>
      </div>


      <div class="row align-items-end absolute round">
          <form id="params">
              <h6 class="txt-m txt-bold mb6">Point of Interest:</h6>
              <div class="mb12 mr12 toggle-group align-center">
                  <label class="toggle-container">
                      <input name="poi" type="radio" value="transport_stations" id="9gf01vwa" />
                      <div class="toggle toggle--active-null toggle--null">Transport stations</div>
                  </label>
                  <label class="toggle-container">
                      <input name="poi" type="radio" value="shops" id="3hilt6p4"/>
                      <div class="toggle toggle--active-null toggle--null">Shops</div>
                  </label>
              </div>
          </form>
      </div>

       <div class="row align-items-end absolute round" style="bottom: 20%;">
          <form id="accessibility_layers" style="">
              <h6 class="txt-m txt-bold mb6">Show within distance:</h6>
              <div class="mb12 mr12 toggle-group align-center">
                  <label class="toggle-container">
                      <input name="layer" type="radio" value="polygons" id="pol" />
                      <div class="toggle toggle--active-null toggle--null">Blocks</div>
                  </label>
                  <label class="toggle-container">
                      <input name="layer" type="radio" value="buffer" id="buf"/>
                      <div class="toggle toggle--active-null toggle--null">Buffer</div>
                  </label>
              </div>
          </form>
      </div>

<!--      <div>-->
<!--          <h6 class="txt-m txt-bold mb6">Choose distance:</h6>-->
<!--          <form action="#" style="width:80%; font-size: 14px">-->
<!--              <p class="range-field">-->
<!--                  <input type="range" id="test" min="50" max="500" step="50"  value="'+span_text+'">-->
<!--                  <span class="thumb">-->
<!--                      <span class="value"></span>-->
<!--                  </span>-->
<!--              </p>-->
<!--          </form>-->
<!--      </div>-->


  </div>
</div>
</section>



<!--...................Toolbar..............-->
<div class="card text-center" id="toolbar">
  <div class="card-header">
    <ul class="nav nav-pills card-header-pills">
      <li class="nav-item">
        <a class="nav-link active" href="#">Land Use</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">PoI</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" tabindex="-1" aria-disabled="true">Transit</a>
      </li>
    </ul>
  </div>
  <div class="card-body">
<!--    <h5 class="card-title">Special title treatment</h5>-->
<!--    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>-->
<!--    <a href="#" class="btn btn-primary">Go somewhere</a>-->
      <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
          <div class="btn-group me-2" role="group" aria-label="First group" style="width: -webkit-fill-available">
            <button type="button" class="btn btn-secondary">1</button>
            <button type="button" class="btn btn-secondary">2</button>
            <button type="button" class="btn btn-secondary">3</button>
<!--            <button type="button" class="btn btn-primary">4</button>-->
          </div>
<!--          <div class="btn-group me-2" role="group" aria-label="Second group">-->
<!--            <button type="button" class="btn btn-secondary">5</button>-->
<!--            <button type="button" class="btn btn-secondary">6</button>-->
<!--            <button type="button" class="btn btn-secondary">7</button>-->
<!--          </div>-->
<!--          <div class="btn-group" role="group" aria-label="Third group">-->
<!--            <button type="button" class="btn btn-info">8</button>-->
<!--          </div>-->
        </div>

  </div>
</div>




<!--restore changes -->
<div class="btn-group btn-group-sm" id="retore_changes_group" role="group" aria-label="Small button group">
    <button type="button" id="retore_changes" style="display: none" class="btn btn-outline-dark ">Restore changes</button>
</div>


<!-- LEFT CANVAS (LAYERS)-->
<!--<button id="btn-open-layers" class="btn btn-outline-secondary " type="button" ><i style="font-size: 1.1rem" class="material-icons small">filter_none</i></button>-->
<!--<div style="height: 80%" class="split left offcanvas offcanvas-start offcanvas-size-sm menu" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling1" aria-labelledby="offcanvasScrollingLabel">-->
<!--  <div class="offcanvas-header">-->
<!--    <h5 class="offcanvas-title" id="offcanvasScrollingLabel1">Layers</h5>-->
<!--    <button id="btn-close-layers" type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>-->
<!--  </div>-->
<!--  <div class="offcanvas-body" style="height: 85%">-->

<!--&lt;!&ndash;      layers&ndash;&gt;-->
<!--&lt;!&ndash;      <ul class="navbar-nav" style="height: 95%; overflow-y: auto">&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;          justify-content-end flex-grow-1 pe-3&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;          <li class="nav-item dropdown">&ndash;&gt;-->
<!--&lt;!&ndash;              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">&ndash;&gt;-->
<!--&lt;!&ndash;                Land Use&ndash;&gt;-->
<!--&lt;!&ndash;              </a>&ndash;&gt;-->
<!--&lt;!&ndash;              <ul class="dropdown-menu layers_ul">&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  <div class="form-check dropdown-item">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="aspern_blocks_attr">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <label class="form-check-label" for="aspern_blocks_attr">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                        Block Attributes&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    </label>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  </div>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  <div class="form-check dropdown-item">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="aspern_realUseBlocks" >&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <label class="form-check-label" for="aspern_realUseBlocks">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                        Real Use - detailed blocks&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    </label>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  </div>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;                   <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="aspern_blocks_attr_realUseBlocks">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <label class="form-check-label" for="aspern_blocks_attr_realUseBlocks">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;                     <input class="form-check-input" type="checkbox" value="" id="aspern_blocks_attr">&ndash;&gt;-->
<!--&lt;!&ndash;                     <label class="form-check-label" for="aspern_blocks_attr">&ndash;&gt;-->
<!--&lt;!&ndash;                        Generalised blocks&ndash;&gt;-->
<!--&lt;!&ndash;                    </label>&ndash;&gt;-->
<!--&lt;!&ndash;                  </div>&ndash;&gt;-->
<!--&lt;!&ndash;                  <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="aspern_landuse">&ndash;&gt;-->
<!--&lt;!&ndash;                    <label class="form-check-label" for="aspern_landuse">&ndash;&gt;-->
<!--&lt;!&ndash;                        Land Use - block level&ndash;&gt;-->
<!--&lt;!&ndash;                    </label>&ndash;&gt;-->
<!--&lt;!&ndash;                  </div>&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  <div class="form-check dropdown-item">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="osr">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <label class="form-check-label" for="osr">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                        Open Space Ratio&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    </label>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                </div>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;                <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="zoning">&ndash;&gt;-->
<!--&lt;!&ndash;                    <label class="form-check-label" for="zoning">&ndash;&gt;-->
<!--&lt;!&ndash;                        Zoning&ndash;&gt;-->
<!--&lt;!&ndash;                    </label>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  <div class="form-check dropdown-item">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="green_area">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <label class="form-check-label" for="green_area">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                        Green Area&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    </label>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                </div>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                  <div class="form-check dropdown-item">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <input class="form-check-input" type="checkbox" value="" id="max_height">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    <label class="form-check-label" for="max_height">&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                        Maximum height&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                    </label>&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;&lt;!&ndash;                </div>&ndash;&gt;&ndash;&gt;-->

<!--&lt;!&ndash;              </ul>&ndash;&gt;-->
<!--&lt;!&ndash;            </li>&ndash;&gt;-->
<!--&lt;!&ndash;            <li class="nav-item dropdown">&ndash;&gt;-->
<!--&lt;!&ndash;                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">&ndash;&gt;-->
<!--&lt;!&ndash;                  Road & public transport net&ndash;&gt;-->
<!--&lt;!&ndash;                </a>&ndash;&gt;-->
<!--&lt;!&ndash;                <ul class="dropdown-menu layers_ul">&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                        <input class="form-check-input" type="checkbox" value="" id="aspern_roads" >&ndash;&gt;-->
<!--&lt;!&ndash;                        <label class="form-check-label" for="aspern_roads">&ndash;&gt;-->
<!--&lt;!&ndash;                            Street center-line&ndash;&gt;-->
<!--&lt;!&ndash;                        </label>&ndash;&gt;-->
<!--&lt;!&ndash;                  </div>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                        <input class="form-check-input" type="checkbox" value="" id="aspern_publiclines">&ndash;&gt;-->
<!--&lt;!&ndash;                        <label class="form-check-label" for="aspern_publiclines">&ndash;&gt;-->
<!--&lt;!&ndash;                            Public transport lines&ndash;&gt;-->
<!--&lt;!&ndash;                        </label>&ndash;&gt;-->
<!--&lt;!&ndash;                  </div>&ndash;&gt;-->
<!--&lt;!&ndash;                </ul>&ndash;&gt;-->
<!--&lt;!&ndash;              </li>&ndash;&gt;-->
<!--&lt;!&ndash;              <li class="nav-item dropdown">&ndash;&gt;-->
<!--&lt;!&ndash;                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">&ndash;&gt;-->
<!--&lt;!&ndash;                  PoIs&ndash;&gt;-->
<!--&lt;!&ndash;                </a>&ndash;&gt;-->
<!--&lt;!&ndash;                <ul class="dropdown-menu layers_ul">&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                        <input class="form-check-input" type="checkbox" value="" id="shops">&ndash;&gt;-->
<!--&lt;!&ndash;                        <label class="form-check-label" for="shops">&ndash;&gt;-->
<!--&lt;!&ndash;                            Shops&ndash;&gt;-->
<!--&lt;!&ndash;                        </label>&ndash;&gt;-->
<!--&lt;!&ndash;                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                        <input class="form-check-input" type="checkbox" value="" id="aspern_trees_blocks">&ndash;&gt;-->
<!--&lt;!&ndash;                        <label class="form-check-label" for="aspern_trees_blocks">&ndash;&gt;-->
<!--&lt;!&ndash;                            Tree layer&ndash;&gt;-->
<!--&lt;!&ndash;                        </label>&ndash;&gt;-->
<!--&lt;!&ndash;                  </div>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="form-check dropdown-item">&ndash;&gt;-->
<!--&lt;!&ndash;                        <input class="form-check-input" type="checkbox" value="" id="aspern_publicstops" >&ndash;&gt;-->
<!--&lt;!&ndash;                        <label class="form-check-label" for="aspern_publicstops">&ndash;&gt;-->
<!--&lt;!&ndash;                            Public transport stations&ndash;&gt;-->
<!--&lt;!&ndash;                        </label>&ndash;&gt;-->
<!--&lt;!&ndash;                  </div>&ndash;&gt;-->
<!--&lt;!&ndash;                </ul>&ndash;&gt;-->
<!--&lt;!&ndash;              </li>&ndash;&gt;-->
<!--&lt;!&ndash;      </ul>&ndash;&gt;-->


<!--      <section>-->
<!--          <ul class="legend_ul" style="padding-left: 0rem;">-->
<!--        </ul>-->
<!--      </section>-->

<!--  </div>-->
<!--</div>-->


<!-- BOTTOM CANVAS (GRAPHS) -->
<div class="split left bottom split right offcanvas offcanvas-bottom" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
    <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Graphs</h5>
    </div>
    <div class="offcanvas-body">

        <div id="graph1"></div>
        <div id="graph2"></div>

    </div>
</div>






<script>
// var popover = new bootstrap.Popover(document.querySelector('#analyse'), {
//   container: 'body',
//     html : true,
//       content: function() {
//         return document.getElementById('popover_content').outerHTML;}
// })


// initialization collapsible
//$(document).ready(function(){
console.log('collapsible elem', $('.collapsible').collapsible())
$('.collapsible').collapsible();
  //});




// this function will be used to find the index of a layer in the order list of the map
function getKeyByValue(object, value) {
            for (var prop in object) {
                if (object.hasOwnProperty(prop)) {
                    if (object[prop] === value)
                    return prop;
                }
            }
        }

var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl)
})



mapboxgl.accessToken = 'pk.eyJ1IjoiaXVsaWFtaWhhZWxhIiwiYSI6ImNsNmdiMTEwZTBwYmczb3ByMGY2YnhwcGEifQ.iwOH4cy-z0B3Q8a41_yfSQ';
const map = new mapboxgl.Map({
  container: 'map', // container ID
  style: 'mapbox://styles/mapbox/light-v10',
  center: [16.507,48.225], // starting position [lng, lat]
  zoom: 13.66, // starting zoom
 });


// define the html for the legend for each layer
const legend_aspern_blocks_attr=
    '            <li class="label"><span style="background: #60c36c;" data-bs-toggle="tooltip" data-bs-placement="left" title="greenSpace: green open spaces, gardens, agricultural land"></span></li>\n' +
    '            <li class="label"><span style="background: #856666;" data-bs-toggle="tooltip" data-bs-placement="left" title="sealedSpace: public and private sealed area, including roads, bike paths etc."></span></li>\n' +
    '            <li class="label"><span style="background: #ad949e;" data-bs-toggle="tooltip" data-bs-placement="left" title="buildings"></span></li>\n' +
    '            <li class="label"><span style="background: #808080;" data-bs-toggle="tooltip" data-bs-placement="left" title="construction: construction sites, gravel pit"></span></li>\n' +
    '            <li class="label"><span style="background: #0080FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="water"></span></li>\n';




const legend_aspern_realUseBlocks ='   <li><strong>Class (land cover): </strong></li>\n' +
    '            <br>\n' +
    '            <li class="label"><span style="background: #60c36c;"></span>green area: <em>green open spaces, gardens, agricultural land</em></li>\n' +
    '            <li class="label"><span style="background: #856666;"></span>sealed area (excluding buildings): <em>public and private sealed area excluding buildings, including roads, bike paths etc.</em></li>\n' +
    '            <li class="label"><span style="background: #ad949e;"></span>buildings</li>\n' +
    '            <li class="label"><span style="background: #808080;"></span>construction site: <em>construction sites, gravel pit</em></li>\n' +
    '            <li class="label"><span style="background: #0080FF;"></span>water body</li>\n';

const legend_aspern_bkmBlocks = '';

const legend_aspern_landuse =
    '            <li class="label"><span style="background: #88db35;" data-bs-toggle="tooltip" data-bs-placement="left" title="recreation & leisure facilities"></span></li>\n' +
    '            <li class="label"><span style="background: #e2d4c0;" data-bs-toggle="tooltip" data-bs-placement="left" title="business uses"></span></li>\n' +
    '            <li class="label"><span style="background: #60c8c5;" data-bs-toggle="tooltip" data-bs-placement="left" title="water"></span></li>\n' +
    '            <li class="label"><span style="background: #de8d24;" data-bs-toggle="tooltip" data-bs-placement="left" title="industrial & commercial uses"></span></li>\n' +
    '            <li class="label"><span style="background: #8baf76;" data-bs-toggle="tooltip" data-bs-placement="left" title="agriculture"></span></li>\n'+
    '            <li class="label"><span style="background: #bce48b;" data-bs-toggle="tooltip" data-bs-placement="left" title="natural area"></span></li>\n' +
    '            <li class="label"><span style="background: #c4bcef;" data-bs-toggle="tooltip" data-bs-placement="left" title="social infrastructure"></span></li>\n' +
    '            <li class="label"><span style="background: #c2d0a1;" data-bs-toggle="tooltip" data-bs-placement="left" title="technical infrastructure"></span></li>\n' +
    '            <li class="label"><span style="background: #a8cfc6;" data-bs-toggle="tooltip" data-bs-placement="left" title="other transportation uses"></span></li>\n' +
    '            <li class="label"><span style="background: #d9bdc6;" data-bs-toggle="tooltip" data-bs-placement="left" title="residential use"></span></li>\n'+
    '            <li class="label"><span style="background: #d2e0c5;" data-bs-toggle="tooltip" data-bs-placement="left" title="road space"></span></li>\n';


const legend_aspern_roads =
    '            <li class="label"><span style="background: #FFFF66;" data-bs-toggle="tooltip" data-bs-placement="left" title="G: municipal road"></span></li>\n' +
    '            <li class="label"><span style="background: #FF9933;" data-bs-toggle="tooltip" data-bs-placement="left" title="L: state main road"></span></li>\n'+
    '            <li class="label"><span style="background: #a117c7;" data-bs-toggle="tooltip" data-bs-placement="left" title="B: main road"></span></li>\n';



const legend_aspern_publiclines =
    '            <li class="label"><span style="background: #CC0000;" data-bs-toggle="tooltip" data-bs-placement="left" title="13: astax"></span></li>\n' +
    '            <li class="label"><span style="background: #FF8000;" data-bs-toggle="tooltip" data-bs-placement="left" title="3: regional bus"></span></li>\n' +
    '            <li class="label"><span style="background: #FFFF00;" data-bs-toggle="tooltip" data-bs-placement="left" title="2: bus"></span></li>\n' +
    '            <li class="label"><span style="background: #00FF00;" data-bs-toggle="tooltip" data-bs-placement="left" title="5: rapid transit and regional train"></span></li>\n' +
    '            <li class="label"><span style="background: #00FFFF;" data-bs-toggle="tooltip" data-bs-placement="left" title="9: astax"></span></li>\n'+
    '            <li class="label"><span style="background: #0000FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="10: night bus"></span></li>\n' +
    '            <li class="label"><span style="background: #FF33FF;" data-bs-toggle="tooltip" data-bs-placement="left" title="11: night bus"></span></li>\n' +
    '            <li class="label"><span style="background: #FF3399;" data-bs-toggle="tooltip" data-bs-placement="left" title="4: subway"></span></li>\n';



const legend_aspern_trees_blocks =
    '      <div>\n' +
    '        <div class=\'row colors\' style="background: linear-gradient(to right, #99FF99, #66FF66,#33FF33, #00CC00, #00CC00, #009900);">\n' +
    '        </div>\n' +
    '        <div class=\'row labels\'>\n' +
    '          <div class=\'label\'>0</div>\n' +
    '          <div class=\'label\'>1</div>\n' +
    '          <div class=\'label\'>2</div>\n' +
    '          <div class=\'label\'>3</div>\n' +
    '          <div class=\'label\'>4</div>\n' +
    '          <div class=\'label\'>5</div>\n' +
    '        </div>\n' +
    '      </div>\n' +
    '    </div>'+
    '<div>\n';


const legend_aspern_publicstops = legend_aspern_publiclines;

const legend_shops = '';

const legend_zoning =
    '            <li class="label"><span style="background: #774c43;" data-bs-toggle="tooltip" data-bs-placement="left" title="E: recreation area"></span></li>\n' +
    '            <li class="label"><span style="background: #8B4513;" data-bs-toggle="tooltip" data-bs-placement="left" title="GB: mixed developement"></span></li>\n' +
    '            <li class="label"><span style="background: #D2691E;" data-bs-toggle="tooltip" data-bs-placement="left" title="GBBG: mixed developement - business developement area"></span></li>\n' +
    '            <li class="label"><span style="background: #CD853F;" data-bs-toggle="tooltip" data-bs-placement="left" title="GBGV: mixed developement - business district"></span></li>\n' +
    '            <li class="label"><span style="background: #F4A460;" data-bs-toggle="tooltip" data-bs-placement="left" title="IG: industrial area"></span></li>\n'+
    '            <li class="label"><span style="background: #DEB887;" data-bs-toggle="tooltip" data-bs-placement="left" title="S: protected area"></span></li>\n' +
    '            <li class="label"><span style="background: #FFE4B5;" data-bs-toggle="tooltip" data-bs-placement="left" title="WO: residential area"></span></li>\n' +
    '            <li class="label"><span style="background: #000000;" data-bs-toggle="tooltip" data-bs-placement="left" title="Other"></span></li>\n'


const legend_osr = '<div>\n' +
    '      <div>\n' +
    '        <div class=\'row colors\' style="background: linear-gradient(to right, #a9d6e5, #89c2d9,#61a5c2, #468faf, #2c7da0, #2a6f97, #014f86, #01497c, #013a63);">\n' +
    '        </div>\n' +
    '        <div class=\'row labels\'>\n' +
    '          <div class=\'label\'>5</div>\n' +
    '          <div class=\'label\'>10</div>\n' +
    '          <div class=\'label\'>30</div>\n' +
    '          <div class=\'label\'>50</div>\n' +
    '          <div class=\'label\'>80</div>\n' +
    '          <div class=\'label\'>100</div>\n' +
    '        </div>\n' +
    '      </div>\n' +
    '    </div>'+
    '<div>\n';


const legend_green_area = '<div>\n' +
    '      <div>\n' +
    '        <div class=\'row colors\' style="background: linear-gradient(to right, #72de62, #6cd15c,#66c758, #62bf54, #5eb851, #57a84a, #4f9943, #478a3d, #3e7835, #34662d);">\n' +
    '        </div>\n' +
    '        <div class=\'row labels\'>\n' +
    '          <div class=\'label\'>10</div>\n' +
    '          <div class=\'label\'>30</div>\n' +
    '          <div class=\'label\'>50</div>\n' +
    '          <div class=\'label\'>70</div>\n' +
    '          <div class=\'label\'>90</div>\n' +
    '          <div class=\'label\'>110</div>\n' +
    '        </div>\n' +
    '      </div>\n' +
    '    </div>';

const legend_max_height = '<div>\n' +
    '      <div>\n' +
    '        <div class=\'row colors\' style="background: linear-gradient(to right, #edc4b3, #e6b8a2,#deab90, #cd9777, #c38e70, #b07d62, #9d6b53, #8a5a44);">\n' +
    '        </div>\n' +
    '        <div class=\'row labels\'>\n' +
    '          <div class=\'label\'>10</div>\n' +
    '          <div class=\'label\'>30</div>\n' +
    '          <div class=\'label\'>50</div>\n' +
    '          <div class=\'label\'>70</div>\n' +
    '          <div class=\'label\'>90</div>\n' +
    '          <div class=\'label\'>100</div>\n' +
    '        </div>\n' +
    '      </div>\n' +
    '    </div>';



// store the properties to be displayed for each layer
const properties_aspern_blocks_attr = ['main_cover', 'OSR', 'max_height', 'count_trees', 'count_trees20m', 'count_shops', 'zoning']
const properties_aspern_realUseBlocks = ['class'];
const properties_aspern_bkmBlocks = ['height'];
const properties_aspern_landuse = ['landuse'];
const properties_aspern_roads = ['name', 'category', 'form ', 'width '];
const properties_aspern_publiclines = ['line', 'line_type'];
const properties_aspern_trees_blocks = ['species', 'year', 'address', 'height'];
const properties_aspern_publicstops = ['stop_name', 'line', 'line_type'];
const properties_shops = ['shop'];
const properties_osr = ['main_cover', 'OSR', 'openspace'];
const properties_zoning = ['main_cover', 'zoning_code', 'zoning'];
const properties_green_area = ['main_cover', 'area_green_rel'];
const properties_max_height = ['main_cover', 'max_height'];


// define the dictionaries that are going to store the geojson data that is going to get updated
// var data = '';
// data_prototype_layerWGS84 = '';
data_aspern_blocks_attr=''
data_aspern_realUseBlocks = '';
data_aspern_bkmBlocks = '';
// data_aspern_landuse = '';
data_aspern_roads = '';
data_aspern_publiclines = '';
data_aspern_trees_blocks = '';
data_aspern_publicstops = '';
data_shops = '';
// define the dictionaries that are going to store the geojson data that is going to stay intact
// original_data_prototype_layerWGS84 = '';
original_data_aspern_blocks_attr=''
original_data_aspern_realUseBlocks = '';
original_data_aspern_bkmBlocks = '';
// original_data_aspern_landuse = '';
original_data_aspern_roads = '';
original_data_aspern_publiclines = '';
original_data_aspern_trees_blocks = '';
original_data_aspern_publicstops = '';
original_data_shops = '';

// const file_path = ["../data/prototype_layerWGS84.geojson","../data/final/aspern_blocks_attr.geojson", "../data/final/aspern_blocks_final.geojson", "../data/final/aspern_realUseBlocks.geojson", "../data/final/aspern_landcover_final.geojson", "../data/final/aspern_bkmBlocks.geojson", "../data/final/aspern_landuse.geojson", "../data/final/aspern_roads.geojson", "../data/final/aspern_publiclines.geojson", "../data/final/aspern_trees_blocks.geojson", "../data/final/aspern_publicstops.geojson", "../data/final/shops.geojson"]
const file_path = ["../data/final/aspern_blocks_final.geojson", "../data/final/aspern_landcover_final.geojson", "../data/final/aspern_bkmBlocks.geojson",  "../data/final/aspern_roads.geojson", "../data/final/aspern_publiclines.geojson", "../data/final/aspern_trees_blocks.geojson", "../data/final/aspern_publicstops.geojson", "../data/final/shops.geojson"]


//..............open all files...............//
cnt = 0, xmlhttp = new XMLHttpRequest(), method = "GET";
function getXml() {
  xmlhttp.open(method, file_path[cnt], true);
  xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState === XMLHttpRequest.DONE && xmlhttp.status === 200) {
        try {
            const json_response = JSON.parse(this.responseText);
            console.log(JSON.parse(this.responseText).name);
            switch(json_response.name){
                // case 'prototype_layerWGS84':
                //     original_data_prototype_layerWGS84 = json_response;
                //     data_prototype_layerWGS84 = json_response;
                //     load_layer_prototype_layerWGS84()
                //     break;
                case 'aspern_blocks_final':  //'aspern_blocks_attr4':
                    data= json_response;
                    data_aspern_blocks_attr = json_response;
                    original_data_aspern_blocks_attr = json_response;
                    // load_layer_aspern_blocks_attr()
                    load_layer_aspern_landuse()
                    load_layer_zoning()
                    load_layer_osr()
                    load_layer_green_area()
                    load_layer_max_height()
                    break;
                case 'aspern_landcover_final':  //'aspern_realUseBlocks':
                    data_aspern_realUseBlocks = json_response;
                    original_data_aspern_realUseBlocks = json_response;
                    //load_layer_aspern_realUseBlocks()
                    load_layer_aspern_blocks_attr_realUseBlocks()
                    break;
                case 'aspern_bkmBlocks':
                    data_aspern_bkmBlocks = json_response;
                    original_data_aspern_bkmBlocks = json_response;
                    load_layer_aspern_bkmBlocks()
                    break;
                // case 'aspern_landuse_cl':
                //     data_aspern_landuse = json_response;
                //     original_data_aspern_landuse = json_response;
                //     load_layer_aspern_landuse()
                //     break;
                case 'aspern_roads':
                    data_aspern_roads = json_response;
                    original_data_aspern_roads = json_response;
                    load_layer_aspern_roads()
                    break;
                case 'aspern_publiclines':
                    data_aspern_publiclines = json_response;
                    original_data_aspern_publiclines = json_response;
                    load_layer_aspern_publiclines()
                    break;
                case 'aspern_trees_blocks':
                    data_aspern_trees_blocks = json_response;
                    original_data_aspern_trees_blocks = json_response;
                    load_layer_aspern_trees_blocks()
                    break;
                case 'aspern_publicstops':
                    data_aspern_publicstops = json_response;
                    original_data_aspern_publicstops = json_response;
                    load_layer_aspern_publicstops()
                    break;
                case 'shops':
                    data_shops = json_response;
                    original_data_shops = json_response;
                    load_layer_shops()

                    //console.log(map.style._order)
                    // switch the layers order so that the 3d buildings layer is on top of the landuse layer
                    index_landuse = getKeyByValue(map.style._order, 'layer_aspern_landuse');
                    index_bkm = getKeyByValue(map.style._order, 'layer_aspern_bkmBlocks');
                    map.style._order[index_bkm] = 'layer_aspern_landuse';
                    map.style._order[index_landuse] = 'layer_aspern_bkmBlocks';
                    break;
            }
        }
        catch (error) {
            console.log('Error parsing JSON:', error, data);
        }
      cnt++;
      if (cnt < file_path.length) getXml(); // call again
    }
  };
  xmlhttp.send();
}
//getXml(); // start it


// navigation
var nav = new mapboxgl.NavigationControl();
map.addControl(nav, 'bottom-left')

map.addControl(new mapboxgl.ScaleControl(), 'bottom-right');


// functions for loading the different layers
// function load_layer_prototype_layerWGS84(){
//       map.addLayer(
//       {
//         'id': 'layer_prototype_layerWGS84',
//         'type': 'fill',
//         'source': {
//             type: 'geojson',
//             data: data_prototype_layerWGS84
//             },
//         'paint': {
//
//         'fill-color': [
//                 'match',
//                 ['get', 'LAYER'],
//                 'Grnflche',
//                 '#60c36c',
//                 'sealed',
//                 '#856666',
//                 'Gebude',
//                 '#ad949e',
//                 '#000000' // any other store type
//               ]
//         },
//         'layout': {
//                 'visibility': 'none'
//         },
//       });
// }

// function load_layer_aspern_blocks_attr(){
//     map.addLayer(
//       {
//         'id': 'layer_aspern_blocks_attr',
//         'type': 'fill',
//         'source': {
//             type: 'geojson',
//             data: data_aspern_blocks_attr
//             },
//         'paint': {
//         'fill-color': [
//                 'match',
//                 ['get', 'main_cover'],
//                 'green area',
//                 '#60c36c',
//                 'other sealed area',
//                 '#856666',
//                 'buildings',
//                 '#ad949e',
//                 'construction site',
//                 '#808080',
//                 'water',
//                 '#0080FF',
//                 '#000000' // any other store type
//               ]
//         },
//         'layout': {
//                 'visibility': 'none'
//         },
//       });
// }

// function load_layer_aspern_realUseBlocks(){
//     map.addLayer(
//       {
//         'id': 'layer_aspern_realUseBlocks',
//         'type': 'fill',
//         'source': {
//             type: 'geojson',
//             data: data_aspern_realUseBlocks
//             },
//         'paint': {
//         'fill-color': [
//                 'match',
//                 ['get', 'class'],
//                 'green area',
//                 '#60c36c',
//                 'sealed area (excluding buildings)',
//                 '#856666',
//                 'buildings',
//                 '#ad949e',
//                 'construction site',
//                 '#808080',
//                 'water body',
//                 '#0080FF',
//                 '#000000' // any other store type
//               ]
//         },
//         'layout': {
//                 'visibility': 'none'
//         },
//       });
// }

function load_layer_aspern_bkmBlocks(){
    map.addLayer(
    {
        'id': 'layer_aspern_bkmBlocks',
        'source': {
            type: 'geojson',
            data: data_aspern_bkmBlocks
            },
        'type': 'fill-extrusion',
        'paint': {
        'fill-extrusion-color': '#aaa',
        // Use an 'interpolate' expression to
        // add a smooth transition effect to
        // the buildings as the user zooms in.
        'fill-extrusion-height': [
        'interpolate',
        ['linear'],
        ['zoom'],
        15,
        0,
        15.05,
        ['to-number', ['get', 'height']]
        ],
        'fill-extrusion-base': [
        'interpolate',
        ['linear'],
        ['zoom'],
        15,
        0,
        15.05,
        ['get', 'min_height']
        ],
        'fill-extrusion-opacity': 0.6
        },
        'layout': {
                'visibility': 'none'
        },
    });
}

function load_layer_aspern_landuse(){
    // map.addLayer(
    //   {
    //     'id': 'layer_aspern_landuse',
    //     'type': 'fill',
    //     'source': {
    //         type: 'geojson',
    //         data: data_aspern_landuse
    //         },
    //     'paint': {
    //
    //     'fill-color': [
    //             'match',
    //             ['get', 'use_lvl2'],
    //             'recreation and leisure facilities',
    //             '#88db35',
    //             'business and mixed use with emphasis on business activity',
    //             '#e2d4c0',
    //             'water',
    //             '#60c8c5',
    //             'industrial and commercial uses',
    //             '#de8d24',
    //             'agriculture',
    //             '#8baf76',
    //             'natural area',
    //             '#bce48b',
    //             'social infrastructure',
    //             '#c4bcef',
    //             'technical infrastructure/art buildings/special uses',
    //             '#c2d0a1',
    //             'other transportation uses',
    //             '#a8cfc6',
    //             'residential and mixed use with emphasis on residential',
    //             '#d9bdc6',
    //             'road space',
    //             '#d2e0c5',
    //
    //             '#000000' // any other store type
    //           ]
    //     },
    //     'layout': {
    //             'visibility': 'none'
    //     },
    //   });
     map.addLayer(
      {
        'id': 'layer_aspern_landuse',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {

        'fill-color': [
                'match',
                ['get', 'landuse'],
                'recreation & leisure facilities',
                '#88db35',
                'business uses',
                '#e2d4c0',
                'water',
                '#60c8c5',
                'industrial & commercial uses',
                '#de8d24',
                'agriculture',
                '#8baf76',
                'natural area',
                '#bce48b',
                'social infrastructure',
                '#c4bcef',
                'technical infrastructure',
                '#c2d0a1',
                'other transportation uses',
                '#a8cfc6',
                'residential use',
                '#d9bdc6',
                'road space',
                '#d2e0c5',

                '#000000' // any other store type
              ]
        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_aspern_roads(){
      map.addLayer(
      {
        'id': 'layer_aspern_roads',
        'type': 'line',
        'source': {
            type: 'geojson',
            data: data_aspern_roads
            },
        'paint': {

            'line-color': [
                'match',
                ['get', 'category_code'],
                'G',
                '#FFFF66',
                'L',
                '#FF9933',
                'B',
                '#a117c7',
                '#000000' // any other store type
            ],
            'line-width':[
            'case',
                  ['<=', ['to-number',  ['get', 'width']], 5],
                  0.3,
                  ['<=', ['to-number',  ['get', 'width']], 10],
                  0.5,
                  ['<=', ['to-number',  ['get', 'width']], 20],
                  0.7,
                  ['<=', ['to-number',  ['get', 'width']], 30],
                  0.85,
                  ['<=', ['to-number',  ['get', 'width']], 40],
                  1,

                  1
            ]
        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_aspern_publiclines(){
    map.addLayer(
      {
        'id': 'layer_aspern_publiclines',
        'type': 'line',
        'source': {
            type: 'geojson',
            data: data_aspern_publiclines
            },
        'paint': {
            'line-color': [

                'match',
                ['get', 'line_type_code'],
                '13',
                '#CC0000',
                '3',
                '#FF8000',
                '2',
                '#FFFF00',
                '5',
                '#00FF00',
                '9',
                '#00FFFF',
                '10',
                '#0000FF',
                '11',
                '#FF33FF',
                '4',
                '#FF3399',

                '#000000' // any other store type
            ],
        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_aspern_trees_blocks(){
    map.addLayer(
      {
        'id': 'layer_aspern_trees_blocks',
        'type': 'circle',
        'source': {
            type: 'geojson',
            data: data_aspern_trees_blocks
            },
        'paint': {
            'circle-color': [

                'match',
                ['to-string', ['get', 'height_code']],
                '0',
                '#99FF99',
                '1',
                '#66FF66',
                '2',
                '#33FF33',
                '3',
                '#00CC00',
                '4',
                '#00CC00',
                '5',
                '#009900',

                '#000000' // any other store type
            ],
        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_aspern_publicstops(){
    map.addLayer(
      {
        'id': 'layer_aspern_publicstops',
        'type': 'circle',
        'source': {
            type: 'geojson',
            data: data_aspern_publicstops
            },
        'paint': {
            'circle-color': [

                'match',
                ['to-string', ['get', 'line_type_code']],
                '13',
                '#CC0000',
                '3',
                '#FF8000',
                '2',
                '#FFFF00',
                '5',
                '#00FF00',
                '9',
                '#00FFFF',
                '10',
                '#0000FF',
                '11',
                '#FF33FF',
                '4',
                '#FF3399',

                '#000000' // any other store type
            ],
        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_shops(){
    map.addLayer(
      {
        'id': 'layer_shops',
        'type': 'circle',
        'source': {
            type: 'geojson',
            data: data_shops
            },
        'paint': {
            'circle-color':

                '#000000'

        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_index_layer(data_index){
  map.addLayer(
      {
        'id': 'layer_index',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_index
            },
        'paint': {

        'fill-color': [
                'case',
                  ['<=', ['to-number',  ['get', 'div_index']], 0.8],
                  '#e1aeb4',
                  ['<=', ['to-number',  ['get', 'div_index']], 1],
                  '#d3828f',
                  ['<=', ['to-number',  ['get', 'div_index']], 1.4],
                  '#d55f5f',
                  ['<=', ['to-number',  ['get', 'div_index']], 1.8],
                  '#b42f2f',
                  ['<=', ['to-number',  ['get', 'div_index']], 2.21],
                  '#8c172c',

                  '#000005'

              ]
        }
      });
}

function load_layer_aspern_blocks_attr_realUseBlocks(){
    const zoomThreshold = 15;
    // map.addLayer(
    //   {
    //     'id': 'layer_aspern_blocks_attr_zoom',
    //     'type': 'fill',
    //     'maxzoom': zoomThreshold,
    //     'source': {
    //         type: 'geojson',
    //         data: data_aspern_blocks_attr
    //         },
    //     'paint': {
    //     'fill-color': [
    //             'match',
    //             ['get', 'main_cover'],
    //             'green area',
    //             '#60c36c',
    //             'other sealed area',
    //             '#856666',
    //             'buildings',
    //             '#ad949e',
    //             'construction site',
    //             '#808080',
    //             'water',
    //             '#0080FF',
    //             '#000000' // any other store type
    //           ]
    //     },
    //     'layout': {
    //             'visibility': 'none'
    //     },
    //   });


map.addLayer(
      {
        'id': 'layer_aspern_blocks_attr',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {
        'fill-color': [
                'match',
                ['get', 'main_cover'],
                'green area',
                '#60c36c',
                'other sealed area',
                '#856666',
                'buildings',
                '#ad949e',
                'construction site',
                '#808080',
                'water',
                '#0080FF',
                '#000000' // any other store type
              ]
        },
        'layout': {
                'visibility': 'none'
        },
      });


    map.addLayer(
      {
        'id': 'layer_aspern_realUseBlocks_zoom',
        'type': 'fill',
        'minzoom': zoomThreshold,
        'source': {
            type: 'geojson',
            data: data_aspern_realUseBlocks
            },
        'paint': {
        'fill-color': [
                'match',
                ['get', 'class'],
                'green area',
                '#60c36c',
                'sealed area (excluding buildings)',
                '#856666',
                'buildings',
                '#ad949e',
                'construction site',
                '#808080',
                'water body',
                '#0080FF',
                '#000000' // any other store type
              ]
        },
        'layout': {
                'visibility': 'none'
        },
      });

}

function load_layer_osr(){
    // map.addLayer(
    //   {
    //     'id': 'layer_osr',
    //     'type': 'heatmap',
    //     'source': {
    //         type: 'geojson',
    //         data: data_aspern_blocks_attr
    //         },
    //     'paint': {
    //     'heatmap-weight': {
    //             property: 'OSR',
    //             type: 'exponential',
    //             stops: [
    //             [1, 0],
    //             [62, 1]
    //             ]
    //         },
    //         // increase intensity as zoom level increases
    //         'heatmap-intensity': {
    //             stops: [
    //             [11, 1],
    //             [15, 3]
    //             ]
    //         },
    //         // assign color values be applied to points depending on their density
    //         'heatmap-color': [
    //             'interpolate', // addiing an interpolate expression that defines a linear relationship
    //             // between heatmap-density and heatmap-color using a set of input-output pairs
    //             ['linear'],
    //             ['heatmap-density'],
    //             0,
    //             'rgba(236,222,239,0)',
    //             0.2,
    //             '#CCFFE5',
    //             0.4,
    //             '#95eca0',
    //             0.6,
    //             '#24b76d',
    //             0.8,
    //             '#0c8c4f'
    //         ],
    //         // increase radius as zoom increases
    //         'heatmap-radius': {
    //             stops: [
    //             [11, 15],
    //             [15, 20]
    //             ]
    //         },
    //         // decrease opacity to transition into the circle layer
    //         'heatmap-opacity': {
    //             default: 1,
    //             stops: [
    //             [14, 1],
    //             [17, 0]
    //             ]
    //         }
    //     },
    //     'layout': {
    //             'visibility': 'none'
    //     },
    //   });

    map.addLayer(
      {
        'id': 'layer_osr',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {

        'fill-color': [
                'case',
                  ['<=', ['to-number',  ['get', 'OSR']], 5],
                  '#a9d6e5',
                  ['<=', ['to-number',  ['get', 'OSR']], 10],
                  '#89c2d9',
                  ['<=', ['to-number',  ['get', 'OSR']], 15],
                  '#61a5c2',
                  ['<=', ['to-number',  ['get', 'OSR']], 20],
                  '#468faf',
                  ['<=', ['to-number',  ['get', 'OSR']], 30],
                  '#2c7da0',
                  ['<=', ['to-number',  ['get', 'OSR']], 50],
                  '#2a6f97',
                  ['<=', ['to-number',  ['get', 'OSR']], 70],
                  '#014f86',
                  ['<=', ['to-number',  ['get', 'OSR']], 80],
                  '#01497c',
                  ['<=', ['to-number',  ['get', 'OSR']], 100],
                  '#013a63',
                  ['<=', ['to-number',  ['get', 'OSR']], 200],
                  '#01365b',
                  ['<=', ['to-number',  ['get', 'OSR']], 300],
                  '#022c49',
                  ['<=', ['to-number',  ['get', 'OSR']], 400],
                  '#011e31',
                  ['==', ['to-number',  ['get', 'OSR']], 0],
                  '#ede0d4',

                  '#ede0d4'

              ],

        },
        'layout': {
                'visibility': 'none'
        },
      });

}

function load_layer_zoning(){
     map.addLayer(
      {
        'id': 'layer_zoning',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {
        'fill-color': [
                'match',
                ['get', 'zoning'],
                'recreation area',
                '#774c43',
                'mixed developement',
                '#8B4513',
                // 'mixed developement - business developement area',
                 'business developement area',
                '#D2691E',
                // 'mixed developement - business district',
                'commercial district',
                '#CD853F',
                'industrial area',
                '#F4A460',
                'protected area',
                '#DEB887',
                'residential area',
                '#FFE4B5',
                '#efdada' // any other store type
              ]
        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_green_area(){
    map.addLayer(
      {
        'id': 'layer_green_area',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {

        'fill-color': [
                'case',

                  ['<=', ['to-number',  ['get', 'area_green_rel']], 10],
                  '#72de62',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 20],
                  '#6cd15c',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 30],
                  '#66c758',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 40],
                  '#62bf54',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 50],
                  '#5eb851',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 60],
                  '#57a84a',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 70],
                  '#4f9943',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 80],
                  '#478a3d',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 90],
                  '#3e7835',
                  ['<=', ['to-number',  ['get', 'area_green_rel']], 120],
                  '#34662d',
                  ['==', ['to-number',  ['get', 'area_green_rel']], 0],
                 '#dbf0a8',

                  '#dbf0a8'
              ]

        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_max_height(){
    map.addLayer(
      {
        'id': 'layer_max_height',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {

        'fill-color': [
                'case',
                  ['<=', ['to-number',  ['get', 'max_height']], 10],
                  '#edc4b3',
                  ['<=', ['to-number',  ['get', 'max_height']], 20],
                  '#e6b8a2',
                  ['<=', ['to-number',  ['get', 'max_height']], 30],
                  '#deab90',
                  ['<=', ['to-number',  ['get', 'max_height']], 40],
                  '#d69f7e',
                  ['<=', ['to-number',  ['get', 'max_height']], 50],
                  '#cd9777',
                  ['<=', ['to-number',  ['get', 'max_height']], 60],
                  '#c38e70',
                  ['<=', ['to-number',  ['get', 'max_height']], 70],
                  '#b07d62',
                  ['<=', ['to-number',  ['get', 'max_height']], 80],
                  '#9d6b53',
                  ['<=', ['to-number',  ['get', 'max_height']], 100],
                  '#8a5a44',
                  ['==', ['to-number',  ['get', 'max_height']], 0],
                  '#ede0d4',

                  '#ede0d4'

              ],

        },
        'layout': {
                'visibility': 'none'
        },
      });
}

function load_layer_accessibility(data, poi){
  map.addLayer(
      {
        'id': 'layer_accessibility_fill',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data
            },
        'paint': {

        'fill-color': '#8c172c',
        'fill-opacity': 0.5
        },
        // 'layout': {
        //         'visibility': 'none'
        // },
      });

  map.addLayer(
      {
        'id': 'layer_accessibility_line',
        'type': 'line',
        'source': {
            type: 'geojson',
            data: data
            },
        'paint': {

        'line-color': 'rgba(56,2,12,0.91)'
        }
      });

  map.addLayer(
      {
        'id': 'layer_accessibility_points',
        'type': 'circle',
        'source': {
            type: 'geojson',
            data: poi
            },
        'paint': {

        'circle-color': 'rgb(0,0,5)'
        }
      });

  map.addLayer(
      {
        'id': 'layer_aspern_blocks_attr_accessibility',
        'type': 'fill',
        'source': {
            type: 'geojson',
            data: data_aspern_blocks_attr
            },
        'paint': {
        'fill-color': '#C0C0C0',
            // [
            //     'match',
            //     ['get', 'main_cover'],
            //     'green area',
            //     '#60c36c',
            //     'other sealed area',
            //     '#856666',
            //     'buildings',
            //     '#ad949e',
            //     'construction site',
            //     '#808080',
            //     'water',
            //     '#0080FF',
            //     '#000000' // any other store type
            //   ],
            'fill-opacity': 0.6
        },
        // 'layout': {
        //         'visibility': 'none'
        // },
      });

  // switch the layers order so that the 3d buildings layer is on top of the landuse layer
    index_attr = getKeyByValue(map.style._order, 'layer_aspern_blocks_attr_accessibility');
    index_pol = getKeyByValue(map.style._order, 'layer_accessibility_fill');
    map.style._order[index_attr] = 'layer_accessibility_fill';
    map.style._order[index_pol] = 'layer_aspern_blocks_attr_accessibility';

}

var data_shannon_index;
// sending the data for index calculations and receiving the index data
async function sendData(){
    // for shannon index
    // b= document.getElementById('index_calc');
    // //while the indices are calculating, we inform the user that the layer is loading
    // b.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n' +
    //     '  Loading...'

    // the spinner on the card
    c = $('#shannon_content .card-title')[0];
    c.innerHTML = 'Shannon Index  <div class="spinner-border spinner-border-sm" role="status" style="display: inline-block;">\n      ' +
        '<span class="visually-hidden">Loading...</span>\n    </div>'

    //the spinner on the button
    $('#shannon label')[0].innerHTML= 'Shannon  <div class="spinner-border spinner-border-sm" role="status" style="display: inline-block;">\n      ' +
        '<span class="visually-hidden">Loading...</span>\n    </div>';


    console.log('function for sending the data');
    // console.log('json data to send: ', JSON.stringify(eval('data_'+check_id)));
    // const query = await fetch('/flask/', { method: 'POST', body: JSON.stringify(eval('data_'+check_id))});
    const query = await fetch('/flask/', { method: 'POST', body: JSON.stringify(data_aspern_blocks_attr)});
    const data = await query.json();
    console.log(data);
    data_shannon_index = data;

    // make the section bigger so that the graph can fit
    const s= $('#shannon_content')[0];
    s.style.height = 'fit-content'; //'70%'
    //graph data calculation
    // let x = [];
    // for (f of data.features){
    //     x.push(f['properties']['div_index']);
    // }
    let x = await calc_graph_data('histogram', 'numerical', data_shannon_index, 'div_index')
    console.log('graph x: ', x)
    x= x['result'];
    // console.log('x[\'result\']: ', x);
    //graph para
    var trace = {
    x: x,
    type: 'histogram',
    marker: {
            color: '#811515'
        },
      };
    var grdata = [trace];
    graph = document.getElementById('shannon_graph');
    layout= {
            height : 350,
            width : 300,
         margin: {
            l: 0,
          },
        };
    Plotly.newPlot(graph, grdata, layout);



    if( map.getLayer('layer_index')){
        map.getSource('layer_index').setData(data_shannon_index);
        map.setLayoutProperty(
                    'layer_index',
                    'visibility',
                    'visible'
                );
     }
    else {
        load_index_layer(data_shannon_index);
    }
    // b.innerHTML = 'Index';
    c.innerHTML='Shannon Index'
    $('#shannon label')[0].innerHTML= 'Shannon';

    // if(map.getLayer('layer_aspern_landuse').visibility == 'none'){
    //     document.getElementsByClassName('form-check-input')[2].click()
    //     map.setLayoutProperty(
    //                     'layer_aspern_landuse',
    //                     'visibility',
    //                     'visible'
    //                 );
    // }

}

let buffer_data;
let blocks_data
async function calc_accessibility(dist, poi, layer){


    // the spinner on the card
    c = $('#accessibility_content .card-title')[0];
    c.innerHTML = 'Accessibility  <div class="spinner-border spinner-border-sm" role="status" style="display: inline-block;">\n      ' +
        '<span class="visually-hidden">Loading...</span>\n    </div>'




    console.log('function for sending the accessibility data');
    // console.log('json data to send: ', JSON.stringify(eval('data_'+check_id)));
    // const query = await fetch('/flask/', { method: 'POST', body: JSON.stringify(eval('data_'+check_id))});
    const query = await fetch('/accessibility/', { method: 'POST', body: JSON.stringify({'poi':poi, 'dist':dist})});
    const data = await query.json();
    console.log('data', data);
    console.log(typeof data['blocks'])
    buffer_data = JSON.parse(data['buffer']);
    blocks_data =JSON.parse(data['blocks']);


    // map.setLayoutProperty(
    //                 'layer_aspern_landuse',
    //                 'visibility',
    //                 'visible'
    //             );

    let layer_data;
    if (layer == 'polygons'){
        layer_data = blocks_data;
    }
    else{
        layer_data = buffer_data
    }
    const poi_data = poi == 'transport' ? data_aspern_publicstops : data_shops;

    if( map.getLayer('layer_accessibility_fill')){
        map.getSource('layer_accessibility_fill').setData(layer_data);
        map.setLayoutProperty(
                    'layer_accessibility_fill',
                    'visibility',
                    'visible'
                );
        map.getSource('layer_accessibility_line').setData(layer_data);
        map.setLayoutProperty(
                    'layer_accessibility_line',
                    'visibility',
                    'visible'
                );
        map.getSource('layer_accessibility_points').setData(poi_data);
        map.setLayoutProperty(
                    'layer_accessibility_points',
                    'visibility',
                    'visible'
                );

         map.setLayoutProperty(
                    'layer_aspern_blocks_attr_accessibility',
                    'visibility',
                    'visible'
                );
     }
    else {
        load_layer_accessibility(layer_data, poi_data);
    }


    c.innerHTML='Accessibility';


    // if(map.getLayer('layer_aspern_landuse').visibility == 'none'){
    //     document.getElementsByClassName('form-check-input')[2].click()
    //     map.setLayoutProperty(
    //                     'layer_aspern_landuse',
    //                     'visibility',
    //                     'visible'
    //                 );
    // }

}


async function calc_graph_data(graph_type, data_type, data, prop){
    const query = await fetch('/graph/', { method: 'POST', body: JSON.stringify({'graph_type':graph_type, 'data_type':data_type, 'data': data, 'prop': prop})});
    const response = await query.json();
    console.log('api graph response: ', response)
    return response
}


// the dropdown remains open after clicking a layer
$('.navbar-nav .dropdown-menu').on({
	"click":function(e){
      e.stopPropagation();
    }
});
// the dropdown does not close when you click outside the menu
// https://stackoverflow.com/questions/26639346/prevent-bootstrap-dropdown-from-closing-on-clicks#:~:text=You%20need%20to%20stop%20event%20from%20bubbling%20up,where%20it%27s%20eventually%20handled%20by%20Bootstrap%20hiding%20menu.
$(function() {
  var closeble = false;
  $('body').on('click', function (e) {
    if (!$(event.target).is('a.dropdown-toggle')) {
      closeble = false;
    }
  });
  $('.dropdown').on({
    'click': function (event) {
      if ($(event.target).closest('.dropdown-toggle').length) {
        closeble = true;
      } else {
        closeble = false;
      }
    },
    'hide.bs.dropdown': function () {
      return closeble;
    }
  });
});


  map.on('style.load', () => {
      map.setFog({}); // Set the default atmosphere style
  });


  map.on('load', ()=>{
    getXml() // load the local geojson files

      // toggle between original and changed data of the landuse layer
    const restoreb = document.getElementById('retore_changes');
    restoreb.onclick = function (e){
        if (restoreb.innerHTML == 'Restore changes'){
           console.log('restore changes button clicked');
            restoreb.innerHTML = 'Show original';
            const file_path = "../data/final/aspern_blocks_final_updated.geojson";
            const xmlhttp = new XMLHttpRequest();
                xmlhttp.onload = function() {
                  if (this.readyState == 4 && this.status == 200){
                    // console.log(this.responseText);
                    data_aspern_blocks_attr = JSON.parse(this.responseText);
                    map.getSource('layer_aspern_landuse').setData(data_aspern_blocks_attr);
                    console.log(data);
                  } else {
                    console.warn('Did not receive 200 OK from response!')
                  }
                }
                xmlhttp.open("GET", file_path);
                xmlhttp.send();
        }
        else {
            console.log('show original data')
            restoreb.innerHTML = 'Restore changes';
            map.getSource('layer_aspern_landuse').setData(original_data_aspern_blocks_attr);
            data_aspern_blocks_attr = original_data_aspern_blocks_attr;
        }



    }

    //save changes function
      async function save_changes(){
        console.log('save changes function...')
        const query = await fetch('/changes/', { method: 'POST', body: JSON.stringify(data_aspern_blocks_attr)});
      }
    // save changes every 10 seconds
    // const interval = setInterval(save_changes, 10000); // 10 000 miliseconds
    // clearInterval(interval);



      // get the button for sending the data for the index calculation
        const recalc_index_button = document.getElementById('recalculate_index');
        // trigger the function that send the data to the py script
        recalc_index_button.onclick = (function(){
            console.log('recalc index button clicked');
            sendData();
            //$('#index')[0].click();
            $('#index')[0].checked = true;
        });

          // get the button for sending the data for the accessibility calculation
        const calc_accessibility_button = document.getElementById('calc_accessibility');
        // trigger the function that send the data to the py script
        calc_accessibility_button.onclick = (function(){
            console.log('recalc index button clicked');
            const dist = $('.card-body input')[0].value;
            let poi;
            if ($('.card-body form')[1][0].checked){
                poi = 'transport'
            }
            else{
                poi = 'shops'
            }

            let layer;
            if ($('.card-body form')[2][0].checked){
                layer = 'polygons'
            }
            else{
                layer = 'buffer'
            }

            calc_accessibility(dist, poi, layer);

            // $('#accessibility_layers')[0].style.display = 'block'


        });


        // main layers ///////////////////////////////////////////
        const blocks_button =$('#blocks_arrow')[0];
        blocks_button.onclick = function (e){
            if ($('#blocks_content')[0].style.display == 'none')
            {
                $('#blocks_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#blocks_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_blocks_button =$('#btn-close-blocks')[0];
        close_blocks_button.onclick = function (e){
            $('#blocks_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const landuse_button =$('#landuse_arrow')[0];
        landuse_button.onclick = function (e){
            if ($('#landuse_content')[0].style.display == 'none')
            {
                $('#landuse_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#landuse_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_landuse_button =$('#btn-close-landuse')[0];
        close_landuse_button.onclick = function (e){
            $('#landuse_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const zoning_button =$('#zoning_arrow')[0];
        zoning_button.onclick = function (e){
            if ($('#zoning_content')[0].style.display == 'none')
            {
                $('#zoning_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#zoning_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_zoning_button =$('#btn-close-zoning')[0];
        close_zoning_button.onclick = function (e){
            $('#zoning_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const streets_button =$('#streets_arrow')[0];
        streets_button.onclick = function (e){
            if ($('#streets_content')[0].style.display == 'none')
            {
                $('#streets_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#streets_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_streets_button =$('#btn-close-streets')[0];
        close_streets_button.onclick = function (e){
            $('#streets_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const public_lines_button =$('#public_lines_arrow')[0];
        public_lines_button.onclick = function (e){
            if ($('#public_lines_content')[0].style.display == 'none')
            {
                $('#public_lines_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#public_lines_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_public_line_button =$('#btn-close-public_lines')[0];
        close_public_line_button.onclick = function (e){
            $('#public_lines_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const shops_button =$('#shops_arrow')[0];
        shops_button.onclick = function (e){
            if ($('#shops_content')[0].style.display == 'none')
            {
                $('#shops_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#shops_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_shops_button =$('#btn-close-shops')[0];
        close_shops_button.onclick = function (e){
            $('#shops_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const trees_button =$('#trees_arrow')[0];
        trees_button.onclick = function (e){
            if ($('#trees_content')[0].style.display == 'none')
            {
                $('#trees_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#trees_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_trees_button =$('#btn-close-trees')[0];
        close_trees_button.onclick = function (e){
            $('#trees_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const public_stations_button =$('#public_stations_arrow')[0];
        public_stations_button.onclick = function (e){
            if ($('#public_stations_content')[0].style.display == 'none')
            {
                $('#public_stations_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#public_stations_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_public_stations_button =$('#btn-close-public_stations')[0];
        close_public_stations_button.onclick = function (e){
            $('#public_stations_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }


        const shannon_button =$('#shannon_arrow')[0];
        shannon_button.onclick = function (e){
            // show the layer and the content
            if ($('#shannon_content')[0].style.display == 'none')
            {
                $('#shannon_content').css('display', 'block');
                // if( map.getLayer('layer_index')){
                //    map.setLayoutProperty(
                //         'layer_index',
                //         'visibility',
                //         'visible'
                //     );
                //    console.log('make the already calculated index layer visible ')
                // }else{
                //     console.log('calculate index layer first time ');
                //     sendData('');
                // }


            }else{  //hide the layer and the content
                $('#shannon_content')[0].style.display = 'none'
                // if( map.getLayer('layer_index')){
                //    map.setLayoutProperty(
                //         'layer_index',
                //         'visibility',
                //         'none'
                //     );
                // }
            }

        }
        const close_shannon_button =$('#btn-close-shannon')[0];
        close_shannon_button.onclick = function (e){
            $('#shannon_content').css('display', 'none');

            // if( map.getLayer('layer_index')){
            //        map.setLayoutProperty(
            //             'layer_index',
            //             'visibility',
            //             'none'
            //         );
            // }
        }
        const shannon_button_l =$('#index')[0];
        shannon_button_l.onclick = function (e){
            console.log('shannon button layer');
            console.log(this.checked);
            console.log(e);
            // show the layer
            //if ($('#shannon_content')[0].style.display == 'none')
            if (this.checked)
            {
                // $('#shannon_content').css('display', 'block');
                if( map.getLayer('layer_index')){
                   map.setLayoutProperty(
                        'layer_index',
                        'visibility',
                        'visible'
                    );
                   console.log('make the already calculated index layer visible ')
                }else{
                    console.log('calculate index layer first time ');
                    sendData('');
                }


            }else{  //hide the layer
                //$('#shannon_content')[0].style.display = 'none'
                if( map.getLayer('layer_index')){
                   map.setLayoutProperty(
                        'layer_index',
                        'visibility',
                        'none'
                    );
                }
            }

        }
        // const close_shannon_button =$('#btn-close-shannon')[0];
        // close_shannon_button.onclick = function (e){
        //     $('#shannon_content').css('display', 'none');
        //
        //     if( map.getLayer('layer_index')){
        //            map.setLayoutProperty(
        //                 'layer_index',
        //                 'visibility',
        //                 'none'
        //             );
        //     }
        // }


        const green_button =$('#green_arrow')[0];
        green_button.onclick = function (e){
            if ($('#green_content')[0].style.display == 'none')
            {
                $('#green_content').css('display', 'block');
            //     if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#green_content')[0].style.display = 'none'
                // if( map.getLayer('layer_green_area')){
                //    map.setLayoutProperty(
                //         'layer_green_area',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_green_button =$('#btn-close-green')[0];
        close_green_button.onclick = function (e){
            $('#green_content').css('display', 'none');

            //  if( map.getLayer('layer_green_area')){
            //        map.setLayoutProperty(
            //             'layer_green_area',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const osr_button =$('#osr_arrow')[0];
        osr_button.onclick = function (e){
            if ($('#osr_content')[0].style.display == 'none')
            {
                $('#osr_content').css('display', 'block');
            //     if( map.getLayer('layer_osr')){
            //        map.setLayoutProperty(
            //             'layer_osr',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#osr_content')[0].style.display = 'none'
                // if( map.getLayer('layer_osr')){
                //    map.setLayoutProperty(
                //         'layer_osr',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_osr_button =$('#btn-close-osr')[0];
        close_osr_button.onclick = function (e){
            $('#osr_content').css('display', 'none');

            //  if( map.getLayer('layer_osr')){
            //        map.setLayoutProperty(
            //             'layer_osr',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const max_height_button =$('#max_height_arrow')[0];
        max_height_button.onclick = function (e){
            if ($('#max_height_content')[0].style.display == 'none')
            {
                $('#max_height_content').css('display', 'block');
            //     if( map.getLayer('layer_max_height')){
            //        map.setLayoutProperty(
            //             'layer_max_height',
            //             'visibility',
            //             'visible'
            //         );
            // }
            }else {
                $('#max_height_content')[0].style.display = 'none'
                // if( map.getLayer('layer_max_height')){
                //    map.setLayoutProperty(
                //         'layer_max_height',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_max_height_button =$('#btn-close-max_height')[0];
        close_max_height_button.onclick = function (e){
            $('#max_height_content').css('display', 'none');

            //  if( map.getLayer('layer_max_height')){
            //        map.setLayoutProperty(
            //             'layer_max_height',
            //             'visibility',
            //             'none'
            //        );
            // }
        }

        const accessibility_button =$('#accessibility_arrow')[0];
        accessibility_button.onclick = function (e){
            //open the section
            if ($('#accessibility_content')[0].style.display == 'none')
            {
                $('#accessibility_content').css('display', 'block');
                if( map.getLayer('layer_accessibility_fill')){
                   map.setLayoutProperty(
                        'layer_accessibility_fill',
                        'visibility',
                        'visible'
                    );
                   map.setLayoutProperty(
                        'layer_accessibility_line',
                        'visibility',
                        'visible'
                    );
                   map.setLayoutProperty(
                        'layer_accessibility_points',
                        'visibility',
                        'visible'
                    );
                   map.setLayoutProperty(
                        'layer_aspern_blocks_attr_accessibility',
                        'visibility',
                        'visible'
                    );

                   // $('#accessibility_layers')[0].onchange = function (e){
                   //     console.log(e.target.value)
                   //     value = e.target.value;
                   //     if (value == 'buffer'){
                   //         map.getSource('layer_accessibility_fill').setData(buffer_data);
                   //
                   //     }
                   //     else{
                   //         map.getSource('layer_accessibility_fill').setData(blocks_data);
                   //     }
                   // }
                }
                else{
                    //at first when we open the section, we have the transportation option already checked
                    $('.card-body form')[1][0].checked=true
                    //at first when we open the section, we have the polygon layer option already checked
                    $('.card-body form')[2][0].checked=true
                }


                     $('#accessibility_layers')[0].onchange = function (e){
                       console.log(e.target.value)
                       value = e.target.value;
                       if (value == 'buffer'){
                           try {
                               map.getSource('layer_accessibility_fill').setData(buffer_data);
                               map.getSource('layer_accessibility_line').setData(buffer_data);
                           }
                           catch (e) {
                               console.log('no buffer data yet...')
                           }


                       }
                       else{
                           map.getSource('layer_accessibility_fill').setData(blocks_data);
                           map.getSource('layer_accessibility_line').setData(blocks_data);
                       }
                   }

                $('#accessibility')[0].checked = true;


            }else {
                $('#accessibility_content')[0].style.display = 'none'
                // if( map.getLayer('layer_accessibility_fill')){
                //    map.setLayoutProperty(
                //         'layer_accessibility_fill',
                //         'visibility',
                //         'none'
                //     );
                //    map.setLayoutProperty(
                //         'layer_accessibility_line',
                //         'visibility',
                //         'none'
                //     );
                //    map.setLayoutProperty(
                //         'layer_accessibility_points',
                //         'visibility',
                //         'none'
                //     );
                //
                //    map.setLayoutProperty(
                //         'layer_aspern_blocks_attr_accessibility',
                //         'visibility',
                //         'none'
                //     );
                // }
            }
        }
        const close_accessibility_button =$('#btn-close-accessibility')[0];
        close_accessibility_button.onclick = function (e){
            $('#accessibility_content').css('display', 'none');

            //  if( map.getLayer('layer_accessibility_fill')){
            //        map.setLayoutProperty(
            //             'layer_accessibility_fill',
            //             'visibility',
            //             'none'
            //        );
            //        map.setLayoutProperty(
            //             'layer_accessibility_line',
            //             'visibility',
            //             'none'
            //         );
            //        map.setLayoutProperty(
            //             'layer_accessibility_points',
            //             'visibility',
            //             'none'
            //         );
            //        map.setLayoutProperty(
            //             'layer_aspern_blocks_attr_accessibility',
            //             'visibility',
            //             'none'
            //         );
            // }
        }
        const accessibility_button_layer = $('#accessibility')[0];
        accessibility_button_layer.onclick = function (e){
            if (this.checked){
                if( map.getLayer('layer_accessibility_fill')){
                   map.setLayoutProperty(
                        'layer_accessibility_fill',
                        'visibility',
                        'visible'
                    );
                   map.setLayoutProperty(
                        'layer_accessibility_line',
                        'visibility',
                        'visible'
                    );
                   map.setLayoutProperty(
                        'layer_accessibility_points',
                        'visibility',
                        'visible'
                    );
                   map.setLayoutProperty(
                        'layer_aspern_blocks_attr_accessibility',
                        'visibility',
                        'visible'
                    );
                }
            }else
            {
                if( map.getLayer('layer_accessibility_fill')){
                   map.setLayoutProperty(
                        'layer_accessibility_fill',
                        'visibility',
                        'none'
                    );
                   map.setLayoutProperty(
                        'layer_accessibility_line',
                        'visibility',
                        'none'
                    );
                   map.setLayoutProperty(
                        'layer_accessibility_points',
                        'visibility',
                        'none'
                    );

                   map.setLayoutProperty(
                        'layer_aspern_blocks_attr_accessibility',
                        'visibility',
                        'none'
                    );
                }
            }
        }



    //get the canvas that displays the layers options
    canvas_layers = document.getElementsByClassName('offcanvas-start');
    // when you click on the button
    // document.getElementById('btn-open-layers').onclick = (function(){
    //     console.log(canvas_layers);
    //     // it shows the canvas with the layers
    //     canvas_layers[0].className = 'show '+ canvas_layers[0].className; // it adds the class 'show' to the canvas element
    // });
    //when you click on the x button on the canvas with the layers
    // document.getElementById('btn-close-layers').onclick = (function(){
    //     // the canvas is hidden
    //     canvas_layers[0].className = canvas_layers[0].className.substring(4,canvas_layers[0].className.length);// it removes the class 'show' to the canvas element
    // });


    //get the canvas that displays the legend
    // canvas_legend = document.getElementById('offcanvasScrolling3');
    // // when you click on the button
    // document.getElementById('btn-open-legend').onclick = (function(){
    //     // console.log(canvas_layers);
    //     // it shows the canvas with the legend
    //     canvas_legend.className = 'show '+ canvas_legend.className; // it adds the class 'show' to the canvas element
    // });
    // //when you click on the x button on the canvas with the legend
    // document.getElementById('btn-close-legend').onclick = (function(){
    //     // the canvas is hidden
    //     canvas_legend.className = canvas_legend.className.substring(4,canvas_legend.className.length);// it removes the class 'show' to the canvas element
    // });



    ///... here comes code for switching between layers ... ///
    const layer_inputs = document.getElementsByClassName('form-check-input');

    for(const layer_input of layer_inputs){
        layer_input.onclick = function(e){
            // console.log(this);
            // console.log(e);

            // hide the index layer if it is loaded
            // if( map.getLayer('layer_index')){
            //    map.setLayoutProperty(
            //         'layer_index',
            //         'visibility',
            //         'none'
            //     );
            // }

            // hide the index calculation button
            //document.getElementById('index_calc').style.display = "none";

            // every time you click on a layer, the properties from the previous clicked feature disappear
            //var content = document.getElementById('property-body');
            //content.innerHTML = ''; // delete previous content

            // get the html elements for the start, end and bottom canvases
            const canvas_start_el = document.getElementsByClassName('offcanvas-start')[0];
            // const canvas_end_el = document.getElementsByClassName('offcanvas-end')[0];
            const canvas_bottom_el = document.getElementsByClassName('offcanvas-bottom')[0];
            // get the map container
            const map_el = document.getElementById('map');
            // get the 3d button
            const button3d_el = document.getElementsByClassName('form-switch')[0];

            // check classes for the canvases
            // if (canvas_start_el.classList.includes(''))




            // store the html input element id that displays each layer
            // with this id we create the different variables or functions for each layer
            let check_id = layer_input.id;

            // store the clicked layer name
            var clickedLayer = 'layer_'+check_id;

            // if (check_id == 'aspern_blocks_attr_realUseBlocks'){
            //     clickedLayer = 'layer_aspern_blocks_attr';
            //     // check_id = 'aspern_blocks_attr';
            // }


            // if (check_id == 'aspern_landuse'){
            //     // clickedLayer = 'layer_aspern_blocks_attr';
            //     check_id = 'aspern_blocks_attr';
            // }
            console.log('check id: ', check_id)
            console.log('cliked layer: ', clickedLayer)

            const legend_ul = document.getElementsByClassName('legend_ul')[0];
            // const legend = document.getElementById('legend');

            // if we unclick a layer
            if(!(layer_input.checked)){
                // if (check_id == 'aspern_blocks_attr_realUseBlocks'){
                //     map.setLayoutProperty(
                //         'layer_aspern_realUseBlocks_zoom',
                //         'visibility',
                //         'none'
                //     );
                // }

                console.log('unclicked the layer')

                // we also hide the 2nd layer with more detailed blocks
                // that's shown only at certain zoom level
                  if (check_id == 'aspern_blocks_attr'){
                    map.setLayoutProperty(
                        'layer_aspern_realUseBlocks_zoom',
                        'visibility',
                        'none'
                    );
                }
                 // we hide the layer clicked with the check id
                map.setLayoutProperty(
                    clickedLayer,
                    'visibility',
                    'none'
                );

                // if we unlick the 3d building we set a pitch normal
                if(clickedLayer == 'layer_aspern_bkmBlocks'){
                    map.setPitch(0);
                }

                // if the layer has any plots shown, we delete them
                delete_graph();

                // check canvases and map classes
                // if ((canvas_start_el.classList).contains('split')){
                //     canvas_start_el.classList.replace('split', 'split_no_graph');
                // }
                // if ((canvas_end_el.classList).contains('split')){
                //     canvas_end_el.classList.replace('split', 'split_no_graph');
                // }

                // we show the map on 100% display
                if ((map_el.classList).contains('split')){
                    map_el.classList.replace('split', 'split_no_graph');
                }
                // the bottom canvas with the graphs disappears
                if ((canvas_bottom_el.classList).contains('show')){
                    canvas_bottom_el.classList.remove('show');
                }
                //the button with the 3d buidings replaces one class so that it is displayed accordingly
                // we show it at the with the style considering no bottom canvas
                 if ((button3d_el.classList).contains('button3d_bottom_graph')){
                    // button3d_el.classList.remove('button3d_bottom_graph');
                    // button3d_el.classList.add('button3d_bottom_no_graph');
                    button3d_el.classList.replace('button3d_bottom_graph', 'button3d_bottom_no_graph');
                }

                 // when we unclick the lanuse layer, we hide the button that restores its data
                 if(check_id == 'aspern_landuse'){
                        restoreb.style.display = 'none';
                    }

                // remove legend
                //legend_ul.style.display = "none";

            }
            //if we click a layer
            else
            {

                console.log('clicked the layer')
                // if we show the 3d building we set a pitch to the map
                if(clickedLayer == 'layer_aspern_bkmBlocks'){
                    // loadIconsLayer();
                    map.setPitch(45);
                }

                // if (check_id == 'aspern_blocks_attr_realUseBlocks'){
                //     map.setLayoutProperty(
                //         'layer_aspern_realUseBlocks_zoom',
                //         'visibility',
                //         'visible'
                //     );
                // }

                // we also show the detailed blocks layer that is visible when zooming in
                if (check_id == 'aspern_blocks_attr'){
                map.setLayoutProperty(
                        'layer_aspern_realUseBlocks_zoom',
                        'visibility',
                        'visible'
                    );
            }

                // we make visible the layer with the id that we clicked
                map.setLayoutProperty(
                    clickedLayer,
                    'visibility',
                    'visible'
                );

                //if any left graph, delete it
                delete_graph();

                // load the graphs
                try{
                    eval('graph_'+check_id)(eval('data_'+check_id));

                    console.log('show graph');
                    //replace their split class with the class that has the same properties, but with the height 100%
                    // canvas_start_el.classList.replace('split_no_graph', 'split');
                    canvas_end_el.classList.replace('split_no_graph', 'split');  // comment so that the graphs are displayed
                    map_el.classList.replace('split_no_graph', 'split');
                    // show the bottom canvas
                    canvas_bottom_el.classList.add('show');
                    button3d_el.classList.replace('button3d_bottom_no_graph','button3d_bottom_graph');

                }
                catch(err){
                    console.log(err)
                    console.log('no graph function')
                }

                // show legend
                // legend_ul.style.display = "block";
                // try{
                //
                //     legend_ul.innerHTML = eval('legend_'+check_id);
                //     if(check_id == 'aspern_landuse'){
                //         legend_ul.innerHTML = legend_aspern_landuse;
                //     }
                // }
                // catch(err){
                //     legend_ul.innerHTML = '';
                //     console.log('no legend')
                // }

                // if(check_id == 'aspern_blocks_attr_realUseBlocks'){
                //         legend_ul.innerHTML = legend_aspern_blocks_attr;
                //     }

                // if we show the landuse layer, we display also the button for restoring the data
                 if(check_id == 'aspern_landuse'){
                        restoreb.style.display = 'block';
                    }

            }


            map.on('mousemove', clickedLayer, (e) => {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', clickedLayer, (e) => {
                map.getCanvas().style.cursor = '';
            });

            // when we click on the map on the layer checked
            map.on('click', clickedLayer, (e)=>{
                // show the button for calculating indices only for the landuse layer
                // if (clickedLayer == 'layer_aspern_landuse'){
                //     console.log('landuse clicked -> data button')
                //     document.getElementById('index_calc').style.display = "block";
                // }

                // zoom in on the clicked feature
                map.flyTo({center: e.lngLat, zoom:16});

                // store the feature we clicked on
                const clicked_feature = e.features[0];
                console.log('feature clicked: ', clicked_feature)

                // having a variable which stores the id of the layer
                var id_property = '';
                // store the id (its value) of the clicked feature
                var value_clicked_feature_id ='';
                // console.log('data: ', eval('data_'+check_id));
                // assign values for the id name and its value depending on the layer clicked
                // we use these 2 variables when we want to change some properties
                switch(clickedLayer){
                    // case 'layer_prototype_layerWGS84':
                    //     id_property = 'BLK';
                    //     value_clicked_feature_id = clicked_feature.properties.BLK;
                    //     break;
                    case 'layer_aspern_blocks_attr':
                        id_property= 'OBJECTID';//'id';
                        value_clicked_feature_id = clicked_feature.properties.OBJECTID;//id;
                        break;
                    case 'layer_aspern_realUseBlocks':
                        id_property = 'OBJECTID';//'blockID';
                        value_clicked_feature_id = clicked_feature.properties.OBJECTID;//blockID;
                        break;
                    case 'layer_aspern_bkmBlocks':
                        id_property= 'FMZK_ID';
                        value_clicked_feature_id = clicked_feature.properties.FMZK_ID;
                        break;
                    case 'layer_aspern_landuse':
                        id_property= 'OBJECTID';
                        value_clicked_feature_id = clicked_feature.properties.OBJECTID;
                        break;
                    case 'layer_aspern_roads':
                        id_property= 'OBJECTID';
                        value_clicked_feature_id = clicked_feature.properties.OBJECTID;
                        break;
                    case 'layer_aspern_publiclines':
                        id_property= 'OBJECTID';
                        value_clicked_feature_id = clicked_feature.properties.OBJECTID;
                        break;
                    case 'layer_aspern_trees_blocks':
                        id_property= 'BAUM_ID';
                        value_clicked_feature_id = clicked_feature.properties.BAUM_ID;
                        break;
                    case 'layer_aspern_publicstops':
                        id_property= 'OBJECTID';
                        value_clicked_feature_id = clicked_feature.properties.OBJECTID;
                        break;
                    case 'layer_shops':
                        id_property= 'osm_id';
                        value_clicked_feature_id = clicked_feature.properties.osm_id;
                        break;
                }
                console.log('clicked feature id: ', value_clicked_feature_id);

                properties = clicked_feature.properties; // store the feature's properties
                properties_keys = Object.keys(properties); // store the properties keys of the feature
                properties_values = Object.values(properties); // store the properties values of the feature
                console.log('prop keys: ', properties_keys);
                console.log('prop values: ', properties_values);
                console.log('prop len: ', properties_values.length);

                // try{
                //     console.log('abs: ',properties['area_green_abs']);
                //     console.log('rel: ',properties['area_green_rel']);
                //     console.log('max_height: ',properties['max_height'])
                // }catch (e) {
                //     console.log('no attr layer');
                // }


                // for popup
                // const popup_ul = document.createElement('ul');
                // popup_ul.className = "list-group list-group-flush";
                // for (let i=0; i< properties_keys.length; i++){
                //     const li = document.createElement('li');
                //     li.className = 'list-group-item';
                //     li.innerHTML = '<b>'+properties_keys[i]+'</b>: '+properties_values[i];
                //     popup_ul.appendChild(li);
                // }
                const popup = new mapboxgl.Popup()
                  .setLngLat(e.lngLat)
                  .addTo(map);

                // const lngLat = e.lngLat;



                range_property_list = ['height'];

                // for prop canvas
                // creating the list of properties can can be changed directly
                function create_dynamic_prop_canvas(){

                    console.log('properties values in create dynamic func: ', properties_values)
                    //content = document.getElementById('property-body');
                    //content.innerHTML = ''; // delete previous content
                    const ul = document.createElement('ul');
                    ul.className = "list-group list-group-flush"
                    ul.id = 'off-canvas';

                  // if(check_id == 'aspern_blocks_attr_realUseBlocks'){
                  //       imp_prop = properties_aspern_blocks_attr;
                  //   } else {
                      // get the list of properties that we want to show
                      // if such list is not defined, we show all properties
                      try{
                          imp_prop = eval('properties_'+check_id);
                      } catch (err){
                          imp_prop =properties_keys;
                      }

                    //}
                  console.log('type imp prop: ',  imp_prop)

                    for (let i=0; i< properties_keys.length; i++){
                        // have the important properties only shown
                        if (imp_prop.includes(properties_keys[i])){
                            // user-friendly property names
                            let li_prop_user = properties_keys[i];
                            switch(properties_keys[i]){
                                case 'area_green_rel':
                                    li_prop_user = 'share of green space';
                                    break;
                                case 'OSR':
                                    li_prop_user= 'open space ratio';
                                    break;
                                case 'max_height':
                                    li_prop_user = 'maximum building height';
                                    break;
                                case 'count_trees':
                                    li_prop_user= 'stock of trees';
                                    break;
                                case 'count_shops':
                                    li_prop_user= 'number of shops';
                                    break;
                                case 'main_cover': //'class':
                                    li_prop_user= 'land cover';
                                    break;
                                case 'use_lvl1':
                                    li_prop_user= 'generalized land use';
                                    break;
                                case 'use_lvl2':
                                    li_prop_user= 'land use category';
                                    break;
                                case 'use_lvl3':
                                    li_prop_user= 'detailed land use category';
                                    break;
                                case 'form':
                                    li_prop_user= 'construction form of the section';
                                    break;
                                case 'line_type':
                                    li_prop_user= 'means of transport';
                                    break;
                                case 'year':
                                    li_prop_user= 'year of planting';
                                    break;
                                case 'stop_name':
                                    li_prop_user= 'name of stop';
                                    break;
                                case 'shop':
                                    li_prop_user= 'type of shop/service';
                                    break;
                                case 'landuse':
                                    li_prop_user= 'landuse category';
                                    break;
                            }


                            const li = document.createElement('li');
                            li.id = 'p'+ i.toString();
                            li.className = 'list-group-item';
                            li.innerHTML = '<b style="">'+li_prop_user+'</b>: '+'<span style="width: auto" ></span>';
                            ul.appendChild(li);
                            // let span_el = li.getElementsByTagName('span')[0]

                            // putting the range for certain properties that have number values
                            li_prop = properties_keys[i];
                            span_text = properties_values[i];




                            // if the property is one of the above and its value is not null
                            if (range_property_list.includes(li_prop) && span_text!='null'){
                                // we define the range stop number
                                if (Number(span_text)<10){
                                    max_range_nr ='100'
                                }
                                else if (Number(span_text)>1000){
                                    max_range_nr = String(Number(span_text)*3)
                                }
                                else if (Number(span_text)>10000){
                                    max_range_nr = String(Number(span_text)*2)
                                }
                                else{
                                    max_range_nr = String(Math.pow(Number(span_text),2));
                                }

                                li.getElementsByTagName('span')[0].innerHTML = '\n        <form action="#" style="width:130px; font-size: 14px">\n            <p class="range-field">\n                <input type="range" id="test5" min="0" max="'+max_range_nr+'"  value="'+span_text+'"><span class="thumb"><span class="value"></span></span>\n            </p>\n        </form>\n    '
                                // String(Number(span_text)*3)

                                // li.getElementsByTagName('span')[0].onchange = function(e){
                                //     console.log('e: ', e);
                                //     console.log('on change this: ', this);
                                //     let new_value =e.target.value;
                                //     save_dict_property(li, new_value);
                                // }


                            }else
                            // putting the dropdown for landuse property
                            if(properties_keys[i]== 'landuse'){
                                console.log('span text: ', span_text)
                                li.getElementsByTagName('span')[0].innerHTML =
                                    '<form action="#" style="width:150px; font-size: 14px;" id="select_form">\n'+
                                    // '<input style="display: none;"type="text" >'+
                                    '<select name="level2" id="level2" style="display: block;  height: 35px">\n' +
                                    '  <option value="recreation & leisure facilities">recreation & leisure facilities</option>\n' +
                                    '  <option value="water">water</option>\n' +
                                    '  <option value="agriculture">agriculture</option>\n' +
                                    '  <option value="natural area">natural area</option>\n' +
                                    '  <option value="business uses">business uses</option>\n' +
                                    '  <option value="industrial & commercial uses">industrial & commercial uses</option>\n' +
                                    '  <option value="social infrastructure">social infrastructure</option>\n' +
                                    '  <option value="technical infrastructure">technical infrastructure</option>\n' +
                                    '  <option value="residential use">residential use</option>\n' +
                                    '  <option value="road space">road space</option>\n' +
                                    '  <option value="other transportation uses">other transportation uses</option>\n' +
                                    '</select>\n'+
                                    '</form>'

                                li.getElementsByTagName('select')[0].value = span_text;
                                // li.getElementsByTagName('input')[0].value = span_text;
                                // li.getElementsByTagName('span')[0].innerHTML = li.getElementsByTagName('select')[0].value;

                                // li.getElementsByTagName('span')[0].onchange = function(e){
                                //     console.log('e: ', e);
                                //     console.log('on change this: ', this);
                                //     let new_value =e.target.value;
                                //     save_dict_property(li, new_value);
                                // }

                            } else {

                                // li.getElementsByTagName('span')[0].innerHTML= '<input style="width:110px; height: 35px; font-size: 14px; max-width: 130px" type="text"'+'value="'+properties_values[i]+'"'+ 'class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">';
                                li.getElementsByTagName('span')[0].innerHTML= properties_values[i];

                            }

                           li.getElementsByTagName('span')[0].onchange = function(e){
                                console.log('e: ', e);
                                console.log('on change this: ', this);
                                let new_value =e.target.value;

                                if (check_id == 'aspern_landuse'){
                                    // we store the changes of landuse in the main blocks layer
                                    save_dict_property(li, new_value, 'aspern_blocks_attr');
                                }else{
                                    save_dict_property(li, new_value, check_id);
                                }

                            }

                            ul.appendChild(li);

                        }
                        popup.setDOMContent(ul);


                    }
                }
                create_dynamic_prop_canvas();

                // function for saving the changes in the dictionary
                function save_dict_property(li, new_value, data_check_id){
                    console.log('save the data into the dict');
                    // if (check_id == 'aspern_landuse'){
                    //     // clickedLayer = 'layer_aspern_blocks_attr';
                    //     check_id = 'aspern_blocks_attr';
                    // }

                    console.log('data check id: ', data_check_id)

                    for (f of eval('data_'+data_check_id).features){
                        // f is the clicked feature from the dictionary
                        // we find the feature in the dictionary that has been changed (we look for the same id)
                        if ( f['properties'][id_property] == value_clicked_feature_id){
                            console.log('found: ', f);

                            console.log('li in save dict: ', li);

                            dict_key = li.getElementsByTagName('b')[0].innerHTML;


                            // user-friendly prop names changed back to initial names
                            switch(dict_key){
                                case 'share of green space':
                                    dict_key = 'area_green_rel';
                                    break;
                                case 'open space ratio':
                                    dict_key= 'OSR';
                                    break;
                                case 'maximum building height':
                                    dict_key = 'max_height';
                                    break;
                                case 'stock of trees':
                                    dict_key= 'count_trees';
                                    break;
                                case 'number of shops':
                                    dict_key= 'count_shops';
                                    break;
                                case 'land cover':
                                    dict_key= 'main_cover'; //'class';
                                    break;
                                case 'generalized land use':
                                    dict_key= 'use_lvl1';
                                    break;
                                case 'land use category':
                                    dict_key= 'use_lvl2';
                                    break;
                                case 'detailed land use category':
                                    dict_key= 'use_lvl3';
                                    break;
                                case 'construction form of the section':
                                    dict_key= 'form';
                                    break;
                                case 'means of transport':
                                    dict_key= 'line_type';
                                    break;
                                case 'year of planting':
                                    dict_key= 'year';
                                    break;
                                case 'name of stop':
                                    dict_key= 'stop_name';
                                    break;
                                case 'type of shop/service':
                                    dict_key= 'shop';
                                    break;
                                case 'landuse category':
                                    dict_key= 'landuse';
                                    break;
                            }



                            console.log(li.getElementsByTagName('b'));
                            console.log('dict key from li: ', dict_key);
                            console.log('f prop: ', f['properties']);
                            f['properties'][dict_key] =new_value;

                            console.log('clicked layer in save in dict: ', clickedLayer)

                            map.getSource(clickedLayer).setData(eval('data_'+data_check_id));
                            console.log('data after: ', f);
                            feature = f;

                            // call the function that loads the graphs
                            try{
                                eval('graph_'+check_id)(eval('data_'+check_id));
                            }
                            catch(err){  // in case there is no function that shows any graph for the layer clicked
                                console.log('no graph function')
                            }


                            return feature
                        }

                    }
                }


            });
        }
    }




    // ~~~~~ GRAPHS ~~~~~
    function delete_graph(){
        document.getElementById('graph1').innerHTML = '';
        document.getElementById('graph2').innerHTML = '';
    }

    function graph_aspern_blocks_attr(data){ //graph_aspern_blocks_attr(data)
        len_greenSpace = 0;
        len_sealedSpace = 0;
        len_buildings = 0;
        len_construction = 0;
        len_water = 0;

        // count how many of each there are
        for (f of data.features){
            switch(f['properties']['main_cover']){
                case 'greenSpace':
                    len_greenSpace++;
                    break;
                case 'sealedSpace':
                    len_sealedSpace++
                    break;
                case 'buildings':
                    len_buildings++
                    break;
                case 'construction':
                    len_construction++;
                    break;
                case 'water':
                    len_water++;
                    break;
            }
        }

        graph1El = document.getElementById('graph1');
        var data1 = [
        {
            x: ['greenSpace', 'sealedSpace', 'buildings', 'construction', 'water'],
            y: [len_greenSpace, len_sealedSpace, len_buildings, len_construction, len_water],
            type: 'bar'
        }
        ];
        layout= {
            height : 300,
            width : 500,
        };
            Plotly.newPlot( graph1El, data1, layout);

        graph2El = document.getElementById('graph2');
        colors = ['#60c36c', '#856666', '#ad949e', '#808080', '#0080FF'];
        var data2 = [
        {
            labels: ['greenSpace', 'sealedSpace', 'buildings', 'construction', 'water'],
            values: [len_greenSpace, len_sealedSpace, len_buildings, len_construction, len_water],
            type: 'pie',
            marker: {
            colors: colors
        },
        }
        ];
            Plotly.newPlot( graph2El, data2, layout);
    }

    function graph_aspern_trees_blocks(data){

        //bar chart ~~~~~
        dict = {}
        dict2 = {}

        for (f of data.features){

            //bar chart
            if (Object.keys(dict).includes(f['properties']['species'])){ // if the species is already the dictionary key
                dict[f['properties']['species']]++; // we add one to its value ( we count the total of each species)
            }
            else{
                dict[f['properties']['species']]=1; // we initialise it with one, the first counted
            }

            //time series
            if (f['properties']['year']!=0){  // if the year is already the dictionary key
                if (Object.keys(dict2).includes(String(f['properties']['year']))){
                    dict2[f['properties']['year']]++; // add one to the count
                }
                else{
                    dict2[f['properties']['year']]=1; // initialise it with one
                }
            }
        }

        graph1El = document.getElementById('graph1');
        var data1 = [
        {
            x: Object.keys(dict),
            y: Object.values(dict),
            type: 'bar',
            marker: {
            color: '#00994C'
        },
        }
        ];
        layout= {
            height : 300,
            width : 500,
        }

            Plotly.newPlot( graph1El, data1,layout);

        graph2El = document.getElementById('graph2');
        var data2 = [
        {
            x: Object.keys(dict2),
            y: Object.values(dict2),
            type: 'scatter',
            marker: {
              color: '#00994C'
            },
        }
        ];
            Plotly.newPlot( graph2El, data2, layout);
    }

});




</script>

</body>
</html>